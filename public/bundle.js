!function t(e,i,r){function s(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[o]={exports:{}};e[o][0].call(p.exports,function(t){var i=e[o][1][t];return s(i?i:t)},p,p.exports,t,e,i,r)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(t,e,i){"use strict";function r(t){this._node=t,this._projectionType=r.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this._requestingUpdate=!1,this._id=t.addComponent(this),this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._viewDirty=!1,this._perspectiveDirty=!1,this.setFlat()}r.FRUSTUM_PROJECTION=0,r.PINHOLE_PROJECTION=1,r.ORTHOGRAPHIC_PROJECTION=2,r.prototype.toString=function(){return"Camera"},r.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,focalDepth:this._focalDepth,near:this._near,far:this._far}},r.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.projectionType,t.focalDepth,t.near,t.far),!0):!1},r.prototype.set=function(t,e,i,r){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._projectionType=t,this._focalDepth=e,this._near=i,this._far=r},r.prototype.setDepth=function(t){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=r.PINHOLE_PROJECTION,this._focalDepth=t,this._near=0,this._far=0,this},r.prototype.setFrustum=function(t,e){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=r.FRUSTUM_PROJECTION,this._focalDepth=0,this._near=t,this._far=e,this},r.prototype.setFlat=function(){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=r.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this},r.prototype.onUpdate=function(){this._requestingUpdate=!1;var t=this._node.getLocation();if(this._node.sendDrawCommand("WITH").sendDrawCommand(t),this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case r.FRUSTUM_PROJECTION:this._node.sendDrawCommand("FRUSTUM_PROJECTION"),this._node.sendDrawCommand(this._near),this._node.sendDrawCommand(this._far);break;case r.PINHOLE_PROJECTION:this._node.sendDrawCommand("PINHOLE_PROJECTION"),this._node.sendDrawCommand(this._focalDepth);break;case r.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand("ORTHOGRAPHIC_PROJECTION")}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand("CHANGE_VIEW_TRANSFORM"),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))},r.prototype.onTransformChange=function(t){var e=t;this._viewDirty=!0,this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],h=e[6],u=e[7],p=e[8],l=e[9],c=e[10],f=e[11],d=e[12],m=e[13],_=e[14],g=e[15],y=i*a-r*o,v=i*h-s*o,b=i*u-n*o,w=r*h-s*a,T=r*u-n*a,x=s*u-n*h,E=p*m-l*d,S=p*_-c*d,C=p*g-f*d,R=l*_-c*m,A=l*g-f*m,O=c*g-f*_,z=1/(y*O-v*A+b*R+w*C-T*S+x*E);this._viewTransform[0]=(a*O-h*A+u*R)*z,this._viewTransform[1]=(s*A-r*O-n*R)*z,this._viewTransform[2]=(m*x-_*T+g*w)*z,this._viewTransform[3]=(c*T-l*x-f*w)*z,this._viewTransform[4]=(h*C-o*O-u*S)*z,this._viewTransform[5]=(i*O-s*C+n*S)*z,this._viewTransform[6]=(_*b-d*x-g*v)*z,this._viewTransform[7]=(p*x-c*b+f*v)*z,this._viewTransform[8]=(o*A-a*C+u*E)*z,this._viewTransform[9]=(r*C-i*A-n*E)*z,this._viewTransform[10]=(d*T-m*b+g*y)*z,this._viewTransform[11]=(l*b-p*T-f*y)*z,this._viewTransform[12]=(a*S-o*R-h*E)*z,this._viewTransform[13]=(i*R-r*S+s*E)*z,this._viewTransform[14]=(m*v-d*w-_*y)*z,this._viewTransform[15]=(p*w-l*v+c*y)*z},e.exports=r},{}],2:[function(t,e,i){"use strict";function r(){"undefined"!=typeof self&&self.window!==self&&this._enterWorkerMode()}r.prototype._enterWorkerMode=function(){this._workerMode=!0;var t=this;self.addEventListener("message",function(e){t.onMessage(e.data)})},r.prototype.onMessage=null,r.prototype.sendMessage=function(t){this._workerMode?self.postMessage(t):this.onmessage(t)},r.prototype.onmessage=null,r.prototype.postMessage=function(t){return this.onMessage(t)},e.exports=r},{}],3:[function(t,e,i){"use strict";function r(){this._time=0,this._frame=0,this._timerQueue=[],this._updatingIndex=0,this._scale=1,this._scaledTime=this._time}r.prototype.setScale=function(t){return this._scale=t,this},r.prototype.getScale=function(){return this._scale},r.prototype.step=function(t){this._frame++,this._scaledTime=this._scaledTime+(t-this._time)*this._scale,this._time=t;for(var e=0;e<this._timerQueue.length;e++)this._timerQueue[e](this._scaledTime)&&this._timerQueue.splice(e,1);return this},r.prototype.now=function(){return this._scaledTime},r.prototype.getTime=r.prototype.now,r.prototype.getFrame=function(){return this._frame},r.prototype.setTimeout=function(t,e){var i=Array.prototype.slice.call(arguments,2),r=this._time,s=function(s){return s-r>=e?(t.apply(null,i),!0):!1};return this._timerQueue.push(s),s},r.prototype.setInterval=function(t,e){var i=Array.prototype.slice.call(arguments,2),r=this._time,s=function(s){return s-r>=e&&(t.apply(null,i),r=s),!1};return this._timerQueue.push(s),s},r.prototype.clearTimer=function(t){var e=this._timerQueue.indexOf(t);return-1!==e&&this._timerQueue.splice(e,1),this},e.exports=r},{}],4:[function(t,e,i){"use strict";function r(t){if(!t)throw new Error("Dispatch needs to be instantiated on a node");this._context=t,this._queue=[]}function s(t,e){e.length=0;var i,r=0,s=t.length;for(i=0;s>i;i++)"/"===t[i]&&(e.push(t.substring(r,i)),r=i+1);return i-r>0&&e.push(t.substring(r,i)),e}var n=t("./Event");r.prototype.lookupNode=function(t){if(!t)throw new Error("lookupNode must be called with a path");var e=this._queue;if(s(t,e),e[0]!==this._context.getSelector())return void 0;var i,r=this._context.getChildren(),n=1;for(e[0]=this._context;n<e.length;){if(i=r[e[n]],e[n]=i,!i)return void 0;r=i.getChildren(),n++}return i},r.prototype.dispatch=function(t,e){if(!t)throw new Error("dispatch requires an event name as it's first argument");var i,r,s,n,o=this._queue;for(o.length=0,o.push(this._context);o.length;)for(i=o.shift(),i.onReceive&&i.onReceive(t,e),n=i.getChildren(),r=0,s=n.length;s>r;r++)o.push(n[r])},r.prototype.dispatchUIEvent=function(t,e,i){if(!t)throw new Error("dispatchUIEvent needs a valid path to dispatch to");if(!e)throw new Error("dispatchUIEvent needs an event name as its second argument");var r,s=this._queue;for(n.call(i),i.node=this.lookupNode(t);s.length&&(r=s.pop(),r.onReceive&&r.onReceive(e,i),!i.propagationStopped););},e.exports=r},{"./Event":5}],5:[function(t,e,i){"use strict";function r(){this.propagationStopped=!1,this.stopPropagation=s}function s(){this.propagationStopped=!0}e.exports=r},{}],6:[function(t,e,i){"use strict";function r(){var t=this;this._updateQueue=[],this._nextUpdateQueue=[],this._scenes={},this._messages=c,this._inUpdate=!1,this._clock=new s,this._channel=new o,this._channel.onMessage=function(e){t.handleMessage(e)}}var s=t("./Clock"),n=t("./Scene"),o=t("./Channel"),a=t("../renderers/UIManager"),h=t("../renderers/Compositor"),u=t("../render-loops/RequestAnimationFrameLoop"),p=["ENGINE","START"],l=["ENGINE","STOP"],c=["TIME",null];r.prototype.init=function(t){return this.compositor=t&&t.compositor||new h,this.renderLoop=t&&t.renderLoop||new u,this.uiManager=new a(this.getChannel(),this.compositor,this.renderLoop),this},r.prototype.setChannel=function(t){return this._channel=t,this},r.prototype.getChannel=function(){return this._channel},r.prototype._update=function(){this._inUpdate=!0;var t,e=this._clock.now(),i=this._nextUpdateQueue,r=this._updateQueue;for(this._messages[1]=e;i.length;)r.unshift(i.pop());for(;r.length;)t=r.shift(),t&&t.onUpdate&&t.onUpdate(e);this._inUpdate=!1},r.prototype.requestUpdate=function(t){if(!t)throw new Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(t):this._updateQueue.push(t)},r.prototype.requestUpdateOnNextTick=function(t){this._nextUpdateQueue.push(t)},r.prototype.handleMessage=function(t){if(!t)throw new Error("onMessage must be called with an array of messages");for(var e;t.length>0;)switch(e=t.shift()){case"WITH":this.handleWith(t);break;case"FRAME":this.handleFrame(t);break;default:throw new Error("received unknown command: "+e)}return this},r.prototype.handleWith=function(t){var e=t.shift(),i=t.shift();switch(i){case"TRIGGER":var r=t.shift(),s=t.shift();this.getContext(e).getDispatch().dispatchUIEvent(e,r,s);break;default:throw new Error("received unknown command: "+i)}return this},r.prototype.handleFrame=function(t){if(!t)throw new Error("handleFrame must be called with an array of messages");if(!t.length)throw new Error("FRAME must be sent with a time");return this.step(t.shift()),this},r.prototype.step=function(t){if(null==t)throw new Error("step must be called with a time");return this._clock.step(t),this._update(),this._messages.length&&(this._channel.sendMessage(this._messages),this._messages.length=2),this},r.prototype.getContext=function(t){if(!t)throw new Error("getContext must be called with a selector");var e=t.indexOf("/");return t=-1===e?t:t.substring(0,e),this._scenes[t]},r.prototype.getClock=function(){return this._clock},r.prototype.message=function(t){return this._messages.push(t),this},r.prototype.createScene=function(t){return t=t||"body",this._scenes[t]&&this._scenes[t].dismount(),this._scenes[t]=new n(t,this),this._scenes[t]},r.prototype.startEngine=function(){return this._channel.sendMessage(p),this},r.prototype.stopEngine=function(){return this._channel.sendMessage(l),this},e.exports=new r},{"../render-loops/RequestAnimationFrameLoop":31,"../renderers/Compositor":32,"../renderers/UIManager":34,"./Channel":2,"./Clock":3,"./Scene":8}],7:[function(t,e,i){"use strict";function r(){this._calculatedValues={transform:new Float32Array(h),size:new Float32Array(3)},this._requestingUpdate=!1,this._inUpdate=!1,this._updateQueue=[],this._nextUpdateQueue=[],this._freedComponentIndicies=[],this._components=[],this._freedChildIndicies=[],this._children=[],this._parent=null,this._globalUpdater=null,this._lastEulerX=0,this._lastEulerY=0,this._lastEulerZ=0,this._lastEuler=!1,this.value=new r.Spec}var s=t("./Transform"),n=t("./Size"),o=new s,a=new n,h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[1,1,1],p=[0,0,0,1];r.RELATIVE_SIZE=n.RELATIVE,r.ABSOLUTE_SIZE=n.ABSOLUTE,r.RENDER_SIZE=n.RENDER,r.DEFAULT_SIZE=n.DEFAULT,r.Spec=function(){this.location=null,this.showState={mounted:!1,shown:!1,opacity:1},this.offsets={mountPoint:new Float32Array(3),align:new Float32Array(3),origin:new Float32Array(3)},this.vectors={position:new Float32Array(3),rotation:new Float32Array(p),scale:new Float32Array(u)},this.size={sizeMode:new Float32Array([n.RELATIVE,n.RELATIVE,n.RELATIVE]),proportional:new Float32Array(u),differential:new Float32Array(3),absolute:new Float32Array(3),render:new Float32Array(3)},this.UIEvents=[]},r.prototype.getLocation=function(){return this.value.location},r.prototype.getId=r.prototype.getLocation,r.prototype.emit=function(t,e){for(var i=this;i!==i.getParent();)i=i.getParent();return i.getDispatch().dispatch(t,e),this},r.prototype.sendDrawCommand=function(t){return this._globalUpdater.message(t),this},r.prototype.getValue=function(){for(var t=this._children.length,e=this._components.length,i=0,r={location:this.value.location,spec:this.value,components:new Array(e),children:new Array(t)};t>i;i++)this._children[i]&&this._children[i].getValue&&(r.children[i]=this._children[i].getValue());for(i=0;e>i;i++)this._components[i]&&this._components[i].getValue&&(r.components[i]=this._components[i].getValue());return r},r.prototype.getComputedValue=function(){for(var t=this._children.length,e={location:this.value.location,computedValues:this._calculatedValues,children:new Array(t)},i=0;t>i;i++)e.children[i]=this._children[i].getComputedValue();return e},r.prototype.getChildren=function(){return this._children},r.prototype.getParent=function(){return this._parent},r.prototype.requestUpdate=function(t){return this._inUpdate||!this.isMounted()?this.requestUpdateOnNextTick(t):(this._updateQueue.push(t),this._requestingUpdate||this._requestUpdate(),this)},r.prototype.requestUpdateOnNextTick=function(t){return this._nextUpdateQueue.push(t),this},r.prototype.getUpdater=function(){return this._globalUpdater},r.prototype.isMounted=function(){return this.value.showState.mounted},r.prototype.isShown=function(){return this.value.showState.shown},r.prototype.getOpacity=function(){return this.value.showState.opacity},r.prototype.getMountPoint=function(){return this.value.offsets.mountPoint},r.prototype.getAlign=function(){return this.value.offsets.align},r.prototype.getOrigin=function(){return this.value.offsets.origin},r.prototype.getPosition=function(){return this.value.vectors.position},r.prototype.getRotation=function(){return this.value.vectors.rotation},r.prototype.getScale=function(){return this.value.vectors.scale},r.prototype.getSizeMode=function(){return this.value.size.sizeMode},r.prototype.getProportionalSize=function(){return this.value.size.proportional},r.prototype.getDifferentialSize=function(){return this.value.size.differential},r.prototype.getAbsoluteSize=function(){return this.value.size.absolute},r.prototype.getRenderSize=function(){return this.value.size.render},r.prototype.getSize=function(){return this._calculatedValues.size},r.prototype.getTransform=function(){return this._calculatedValues.transform},r.prototype.getUIEvents=function(){return this.value.UIEvents},r.prototype.addChild=function(t){var e=t?this._children.indexOf(t):-1;if(t=t?t:new r,-1===e&&(e=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[e]=t,this.isMounted()&&t.onMount)){var i=this.getId(),s=i+"/"+e;t.onMount(this,s)}return t},r.prototype.removeChild=function(t){var e=this._children.indexOf(t),i=-1!==e;return i&&(this._freedChildIndicies.push(e),this._children[e]=null,this.isMounted()&&t.onDismount&&t.onDismount()),i},r.prototype.addComponent=function(t){var e=this._components.indexOf(t);return-1===e&&(e=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length,this._components[e]=t,this.isMounted()&&t.onMount&&t.onMount(this,e),this.isShown()&&t.onShow&&t.onShow()),e},r.prototype.getComponent=function(t){return this._components[t]},r.prototype.removeComponent=function(t){var e=this._components.indexOf(t);return-1!==e&&(this._freedComponentIndicies.push(e),this.isShown()&&t.onHide&&t.onHide(),this.isMounted()&&t.onDismount&&t.onDismount(),this._components[e]=null),t},r.prototype.addUIEvent=function(t){var e,i=this.getUIEvents(),r=this._components,s=-1!==i.indexOf(t);if(!s){i.push(t);for(var n=0,o=r.length;o>n;n++)e=r[n],e&&e.onAddUIEvent&&e.onAddUIEvent(t)}},r.prototype._requestUpdate=function(t){(t||!this._requestingUpdate&&this._globalUpdater)&&(this._globalUpdater.requestUpdate(this),this._requestingUpdate=!0)},r.prototype._vecOptionalSet=function(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,this._requestingUpdate||this._requestUpdate(),!0):!1},r.prototype.show=function(){var t,e=0,i=this._components,r=i.length;for(this.value.showState.shown=!0;r>e;e++)t=i[e],t&&t.onShow&&t.onShow();for(e=0,i=this._children,r=i.length;r>e;e++)t=i[e],t&&t.onParentShow&&t.onParentShow();return this},r.prototype.hide=function(){var t,e=0,i=this._components,r=i.length;for(this.value.showState.shown=!1;r>e;e++)t=i[e],t&&t.onHide&&t.onHide();for(e=0,i=this._children,r=i.length;r>e;e++)t=i[e],t&&t.onParentHide&&t.onParentHide();return this},r.prototype.setAlign=function(t,e,i){var r=this.value.offsets.align,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,null!=i&&(s=this._vecOptionalSet(r,2,i-.5)||s),s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onAlignChange&&n.onAlignChange(t,e,i)}return this},r.prototype.setMountPoint=function(t,e,i){var r=this.value.offsets.mountPoint,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,null!=i&&(s=this._vecOptionalSet(r,2,i-.5)||s),s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onMountPointChange&&n.onMountPointChange(t,e,i)}return this},r.prototype.setOrigin=function(t,e,i){var r=this.value.offsets.origin,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,null!=i&&(s=this._vecOptionalSet(r,2,i-.5)||s),s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onOriginChange&&n.onOriginChange(t,e,i)}return this},r.prototype.setPosition=function(t,e,i){var r=this.value.vectors.position,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,s=this._vecOptionalSet(r,2,i)||s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onPositionChange&&n.onPositionChange(t,e,i)}return this},r.prototype.setRotation=function(t,e,i,r){var s,n,o,a,h=this.value.vectors.rotation,u=!1;if(null!=r)s=t,n=e,o=i,a=r,this._lastEulerX=null,this._lastEulerY=null,this._lastEulerZ=null,this._lastEuler=!1;else{if(null==t||null==e||null==i)if(this._lastEuler)t=null==t?this._lastEulerX:t,e=null==e?this._lastEulerY:e,i=null==i?this._lastEulerZ:i;else{var p=-2*(h[1]*h[2]-h[3]*h[0]);Math.abs(p)>.99999?(e=null==e?.5*Math.PI*p:e,t=null==t?Math.atan2(-h[0]*h[2]+h[3]*h[1],.5-h[1]*h[1]-h[2]*h[2]):t,i=null==i?0:i):(e=null==e?Math.asin(p):e,t=null==t?Math.atan2(h[0]*h[2]+h[3]*h[1],.5-h[0]*h[0]-h[1]*h[1]):t,i=null==i?Math.atan2(h[0]*h[1]+h[3]*h[2],.5-h[0]*h[0]-h[2]*h[2]):i)}var l=.5*t,c=.5*e,f=.5*i,d=Math.sin(l),m=Math.sin(c),_=Math.sin(f),g=Math.cos(l),y=Math.cos(c),v=Math.cos(f),b=m*_,w=y*_,T=m*v,x=y*v;s=d*x+g*b,n=g*T-d*w,o=g*w+d*T,a=g*x-d*b,this._lastEuler=!0,this._lastEulerX=t,this._lastEulerY=e,this._lastEulerZ=i}if(u=this._vecOptionalSet(h,0,s)||u,u=this._vecOptionalSet(h,1,n)||u,u=this._vecOptionalSet(h,2,o)||u,u=this._vecOptionalSet(h,3,a)||u){var E,S=0,C=this._components,R=C.length;for(t=h[0],e=h[1],i=h[2],r=h[3];R>S;S++)E=C[S],E&&E.onRotationChange&&E.onRotationChange(t,e,i,r)}return this},r.prototype.setScale=function(t,e,i){var r=this.value.vectors.scale,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,s=this._vecOptionalSet(r,2,i)||s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onScaleChange&&n.onScaleChange(t,e,i)}return this},r.prototype.setOpacity=function(t){if(t!==this.value.showState.opacity){this.value.showState.opacity=t,this._requestingUpdate||this._requestUpdate();for(var e,i=0,r=this._components,s=r.length;s>i;i++)e=r[i],e&&e.onOpacityChange&&e.onOpacityChange(t)}return this},r.prototype.setSizeMode=function(t,e,i){var r=this.value.size.sizeMode,s=!1;if(null!=t&&(s=this._resolveSizeMode(r,0,t)||s),null!=e&&(s=this._resolveSizeMode(r,1,e)||s),null!=i&&(s=this._resolveSizeMode(r,2,i)||s),s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onSizeModeChange&&n.onSizeModeChange(t,e,i)}return this},r.prototype._resolveSizeMode=function(t,e,i){if(i.constructor!==String)return this._vecOptionalSet(t,e,i);switch(i.toLowerCase()){case"relative":case"default":return this._vecOptionalSet(t,e,0);case"absolute":return this._vecOptionalSet(t,e,1);case"render":return this._vecOptionalSet(t,e,2);default:throw new Error("unknown size mode: "+i)}},r.prototype.setProportionalSize=function(t,e,i){var r=this.value.size.proportional,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,s=this._vecOptionalSet(r,2,i)||s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onProportionalSizeChange&&n.onProportionalSizeChange(t,e,i)}return this},r.prototype.setDifferentialSize=function(t,e,i){var r=this.value.size.differential,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,s=this._vecOptionalSet(r,2,i)||s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onDifferentialSizeChange&&n.onDifferentialSizeChange(t,e,i)}return this},r.prototype.setAbsoluteSize=function(t,e,i){var r=this.value.size.absolute,s=!1;if(s=this._vecOptionalSet(r,0,t)||s,s=this._vecOptionalSet(r,1,e)||s,s=this._vecOptionalSet(r,2,i)||s){var n,o=0,a=this._components,h=a.length;for(t=r[0],e=r[1],i=r[2];h>o;o++)n=a[o],n&&n.onAbsoluteSizeChange&&n.onAbsoluteSizeChange(t,e,i)}return this},r.prototype._transformChanged=function(t){for(var e,i=0,r=this._components,s=r.length;s>i;i++)e=r[i],e&&e.onTransformChange&&e.onTransformChange(t);for(i=0,r=this._children,s=r.length;s>i;i++)e=r[i],e&&e.onParentTransformChange&&e.onParentTransformChange(t)},r.prototype._sizeChanged=function(t){for(var e,i=0,r=this._components,s=r.length;s>i;i++)e=r[i],e&&e.onSizeChange&&e.onSizeChange(t);for(i=0,r=this._children,s=r.length;s>i;i++)e=r[i],e&&e.onParentSizeChange&&e.onParentSizeChange(t)},r.prototype.getFrame=function(){return this._globalUpdater.getFrame()},r.prototype.getComponents=function(){return this._components},r.prototype.update=function(t){this._inUpdate=!0;for(var e,i=this._nextUpdateQueue,r=this._updateQueue;i.length;)r.unshift(i.pop());for(;r.length;)e=this._components[r.shift()],e&&e.onUpdate&&e.onUpdate(t);var s=this.getSize(),n=this.getTransform(),h=this.getParent(),u=h.getSize(),p=h.getTransform(),l=a.fromSpecWithParent(u,this,s),c=o.fromSpecWithParent(p,this.value,s,u,n);return c&&this._transformChanged(n),l&&this._sizeChanged(s),this._inUpdate=!1,this._requestingUpdate=!1,this.isMounted()?this._nextUpdateQueue.length&&(this._globalUpdater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):(this._parent=null,this.value.location=null,this._globalUpdater=null),this},r.prototype.mount=function(t,e){if(this.isMounted())return this;var i,r=0,s=this._components,n=s.length;for(this._parent=t,this._globalUpdater=t.getUpdater(),this.value.location=e,this.value.showState.mounted=!0;n>r;r++)i=s[r],i&&i.onMount&&i.onMount(this,r);for(r=0,s=this._children,n=s.length;n>r;r++)i=s[r],i&&i.onParentMount&&i.onParentMount(this,e,r);return this._requestingUpdate||this._requestUpdate(!0),this},r.prototype.dismount=function(){if(!this.isMounted())return this;var t,e=0,i=this._components,r=i.length;for(this.value.showState.mounted=!1,this._parent.removeChild(this);r>e;e++)t=i[e],t&&t.onDismount&&t.onDismount();for(e=0,i=this._children,r=i.length;r>e;e++)t=i[e],t&&t.onParentDismount&&t.onParentDismount();return this._requestingUpdate||this._requestUpdate(),this},r.prototype.onParentMount=function(t,e,i){return this.mount(t,e+"/"+i)},r.prototype.onParentDismount=function(){return this.dismount()},r.prototype.receive=function(t,e){for(var i,r=0,s=this._components,n=s.length;n>r;r++)i=s[r],i&&i.onReceive&&i.onReceive(t,e);return this},r.prototype._requestUpdateWithoutArgs=function(){this._requestingUpdate||this._requestUpdate()},r.prototype.onUpdate=r.prototype.update,r.prototype.onParentShow=r.prototype.show,r.prototype.onParentHide=r.prototype.hide,r.prototype.onParentTransformChange=r.prototype._requestUpdateWithoutArgs,r.prototype.onParentSizeChange=r.prototype._requestUpdateWithoutArgs,r.prototype.onShow=r.prototype.show,r.prototype.onHide=r.prototype.hide,r.prototype.onMount=r.prototype.mount,r.prototype.onDismount=r.prototype.dismount,r.prototype.onReceive=r.prototype.receive,e.exports=r},{"./Size":9,"./Transform":10}],8:[function(t,e,i){"use strict";function r(t,e){if(!t)throw new Error("Scene needs to be created with a DOM selector");if(!e)throw new Error("Scene needs to be created with a class like Famous");n.call(this),this._updater=e,this._dispatch=new s(this),this._selector=t,this.onMount(this,t),this._updater.message("NEED_SIZE_FOR").message(t),this.show()}var s=t("./Dispatch"),n=t("./Node"),o=t("./Size");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.getUpdater=function(){return this._updater},r.prototype.getSelector=function(){return this._selector},r.prototype.getDispatch=function(){return this._dispatch},r.prototype.onReceive=function(t,e){if("CONTEXT_RESIZE"===t){if(e.length<2)throw new Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode(o.ABSOLUTE,o.ABSOLUTE,o.ABSOLUTE),this.setAbsoluteSize(e[0],e[1],e[2]?e[2]:0)}},e.exports=r},{"./Dispatch":4,"./Node":7,"./Size":9}],9:[function(t,e,i){"use strict";function r(){this._size=new Float32Array(3)}r.RELATIVE=0,r.ABSOLUTE=1,r.RENDER=2,r.DEFAULT=r.RELATIVE,r.prototype.fromSpecWithParent=function(t,e,i){for(var s,n,o=e.getValue().spec,a=e.getComponents(),h=o.size.sizeMode,u=!1,p=a.length,l=0;3>l;l++){switch(h[l]){case r.RELATIVE:s=i[l],i[l]=t[l]*o.size.proportional[l]+o.size.differential[l];break;case r.ABSOLUTE:s=i[l],i[l]=o.size.absolute[l];break;case r.RENDER:var c,f;for(n=0;p>n;n++)f=a[n],f&&f.getRenderSize&&(c=f.getRenderSize()[l],s=i[l],i[l]=i[l]<c||0===i[l]?c:i[l])}u=u||s!==i[l]}return u},e.exports=r},{}],10:[function(t,e,i){"use strict";function r(){this._matrix=new Float32Array(16)}r.prototype.get=function(){return this._matrix},r.prototype.fromSpecWithParent=function(t,e,i,r,s){s=s?s:this._matrix;var n=s[0],o=s[1],a=s[2],h=s[4],u=s[5],p=s[6],l=s[8],c=s[9],f=s[10],d=s[12],m=s[13],_=s[14],g=t[0],y=t[1],v=t[2],b=t[4],w=t[5],T=t[6],x=t[8],E=t[9],S=t[10],C=t[12],R=t[13],A=t[14],O=e.vectors.position[0],z=e.vectors.position[1],M=e.vectors.position[2],L=e.vectors.rotation[0],U=e.vectors.rotation[1],D=e.vectors.rotation[2],I=e.vectors.rotation[3],P=e.vectors.scale[0],F=e.vectors.scale[1],N=e.vectors.scale[2],k=e.offsets.align[0]*r[0],G=e.offsets.align[1]*r[1],V=e.offsets.align[2]*r[2],q=e.offsets.mountPoint[0]*i[0],W=e.offsets.mountPoint[1]*i[1],H=e.offsets.mountPoint[2]*i[2],B=e.offsets.origin[0]*i[0],K=e.offsets.origin[1]*i[1],j=e.offsets.origin[2]*i[2],Y=I*L,X=I*U,Q=I*D,Z=L*L,J=U*U,$=D*D,tt=L*U,et=L*D,it=U*D,rt=(1-2*(J+$))*P,st=2*(tt+Q)*P,nt=2*(et-X)*P,ot=2*(tt-Q)*F,at=(1-2*(Z+$))*F,ht=2*(it+Y)*F,ut=2*(et+X)*N,pt=2*(it-Y)*N,lt=(1-2*(Z+J))*N,ct=k+O-q+B-(rt*B+ot*K+ut*j),ft=G+z-W+K-(st*B+at*K+pt*j),dt=V+M-H+j-(nt*B+ht*K+lt*j);return s[0]=g*rt+b*st+x*nt,s[1]=y*rt+w*st+E*nt,s[2]=v*rt+T*st+S*nt,s[3]=0,s[4]=g*ot+b*at+x*ht,s[5]=y*ot+w*at+E*ht,s[6]=v*ot+T*at+S*ht,s[7]=0,s[8]=g*ut+b*pt+x*lt,s[9]=y*ut+w*pt+E*lt,s[10]=v*ut+T*pt+S*lt,s[11]=0,s[12]=g*ct+b*ft+x*dt+C,s[13]=y*ct+w*ft+E*dt+R,s[14]=v*ct+T*ft+S*dt+A,s[15]=1,n!==s[0]||o!==s[1]||a!==s[2]||h!==s[4]||u!==s[5]||p!==s[6]||l!==s[8]||c!==s[9]||f!==s[10]||d!==s[12]||m!==s[13]||_!==s[14]},e.exports=r},{}],11:[function(t,e,i){"use strict";function r(t,e){if(!t)throw new Error("DOMElement must be instantiated on a node");if(this._node=t,this._requestingUpdate=!1,this._renderSized=!1,this._requestRenderSize=!1,this._changeQueue=[],this._UIEvents=t.getUIEvents().slice(0),this._classes=["famous-dom-element"],this._requestingEventListeners=[],this._styles={},this.setProperty("display",t.isShown()?"none":"block"),this.onOpacityChange(t.getOpacity()),this._attributes={},this._content="",this._tagName=e&&e.tagName?e.tagName:"div",this._id=t.addComponent(this),this._renderSize=[0,0,0],this._callbacks=new s,e){var i,r;if(e.classes)for(i=0;i<e.classes.length;i++)this.addClass(e.classes[i]);if(e.attributes)for(r in e.attributes)this.setAttribute(r,e.attributes[r]);if(e.properties)for(r in e.properties)this.setProperty(r,e.properties[r]);e.id&&this.setId(e.id),e.content&&this.setContent(e.content),e.cutout===!1&&this.setCutoutState(e.cutout)}}var s=t("../utilities/CallbackStore"),n=2;r.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}},r.prototype.onUpdate=function(){var t=this._node,e=this._changeQueue,i=e.length;if(i&&t){for(t.sendDrawCommand("WITH"),t.sendDrawCommand(t.getLocation());i--;)t.sendDrawCommand(e.shift());this._requestRenderSize&&(t.sendDrawCommand("DOM_RENDER_SIZE"),t.sendDrawCommand(t.getLocation()),this._requestRenderSize=!1)}this._requestingUpdate=!1},r.prototype.onMount=function(t,e){this._node=t,this._id=e,this._UIEvents=t.getUIEvents().slice(0),this.draw(),this.setAttribute("data-fa-path",t.getLocation())},r.prototype.onDismount=function(){this.setProperty("display","none"),this.setAttribute("data-fa-path",""),this._initialized=!1},r.prototype.onShow=function(){this.setProperty("display","block")},r.prototype.onHide=function(){this.setProperty("display","none")},r.prototype.setCutoutState=function(t){this._changeQueue.push("GL_CUTOUT_STATE",t),this._initialized&&this._requestUpdate()},r.prototype.onTransformChange=function(t){this._changeQueue.push("CHANGE_TRANSFORM");for(var e=0,i=t.length;i>e;e++)this._changeQueue.push(t[e]);this.onUpdate()},r.prototype.onSizeChange=function(t){var e=this._node.getSizeMode(),i=e[0]!==n,r=e[1]!==n;return this._initialized&&this._changeQueue.push("CHANGE_SIZE",i?t[0]:i,r?t[1]:r),this._requestingUpdate||this._requestUpdate(),this},r.prototype.onOpacityChange=function(t){return this.setProperty("opacity",t)},r.prototype.onAddUIEvent=function(t){return-1===this._UIEvents.indexOf(t)?(this._subscribe(t),this._UIEvents.push(t)):this._inDraw&&this._subscribe(t),this},r.prototype._subscribe=function(t){this._initialized&&this._changeQueue.push("SUBSCRIBE",t,!0),this._requestingUpdate||this._requestUpdate()},r.prototype.onSizeModeChange=function(t,e,i){(t===n||e===n||i===n)&&(this._renderSized=!0,this._requestRenderSize=!0),this.onSizeChange(this._node.getSize())},r.prototype.getRenderSize=function(){return this._renderSize},r.prototype._requestUpdate=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)},r.prototype.init=function(){this._changeQueue.push("INIT_DOM",this._tagName),this._initialized=!0,this.onTransformChange(this._node.getTransform()),this.onSizeChange(this._node.getSize()),this._requestingUpdate||this._requestUpdate()},r.prototype.setId=function(t){return this.setAttribute("id",t),this},r.prototype.addClass=function(t){return this._classes.indexOf(t)<0?(this._initialized&&this._changeQueue.push("ADD_CLASS",t),this._classes.push(t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this):(this._inDraw&&(this._initialized&&this._changeQueue.push("ADD_CLASS",t),this._requestingUpdate||this._requestUpdate()),this)},r.prototype.removeClass=function(t){var e=this._classes.indexOf(t);return 0>e?this:(this._changeQueue.push("REMOVE_CLASS",t),this._classes.splice(e,1),this._requestingUpdate||this._requestUpdate(),this)},r.prototype.hasClass=function(t){return-1!==this._classes.indexOf(t)},r.prototype.setAttribute=function(t,e){return(this._attributes[t]!==e||this._inDraw)&&(this._attributes[t]=e,this._initialized&&this._changeQueue.push("CHANGE_ATTRIBUTE",t,e),this._requestUpdate||this._requestUpdate()),this},r.prototype.setProperty=function(t,e){return(this._styles[t]!==e||this._inDraw)&&(this._styles[t]=e,
this._initialized&&this._changeQueue.push("CHANGE_PROPERTY",t,e),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},r.prototype.setContent=function(t){return(this._content!==t||this._inDraw)&&(this._content=t,this._initialized&&this._changeQueue.push("CHANGE_CONTENT",t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},r.prototype.on=function(t,e){return this._callbacks.on(t,e)},r.prototype.onReceive=function(t,e){"resize"===t&&(this._renderSize[0]=e.val[0],this._renderSize[1]=e.val[1],this._requestingUpdate||this._requestUpdate()),this._callbacks.trigger(t,e)},r.prototype.draw=function(){var t,e,i;for(this._inDraw=!0,this.init(),e=0,i=this._classes.length;i>e;e++)this.addClass(this._classes[e]);this._content&&this.setContent(this._content);for(t in this._styles)this._styles[t]&&this.setProperty(t,this._styles[t]);for(t in this._attributes)this._attributes[t]&&this.setAttribute(t,this._attributes[t]);for(e=0,i=this._UIEvents.length;i>e;e++)this.onAddUIEvent(this._UIEvents[e]);this._inDraw=!1},e.exports=r},{"../utilities/CallbackStore":36}],12:[function(t,e,i){"use strict";function r(t,e,i){var r=this;t.classList.add("famous-dom-renderer"),u=u||a("transform"),this._compositor=i,this._target=null,this._parent=null,this._path=null,this._children=[],this._root=new n(t,e),this._boundTriggerEvent=function(t){return r._triggerEvent(t)},this._selector=e,this._elements={},this._elements[e]=this._root,this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._size=[null,null]}function s(t){for(var e=[],i=t.target;i!==document.body;)e.push(i),i=i.parentNode;return e}var n=t("./ElementCache"),o=t("./Math"),a=t("../utilities/vendorPrefix"),h=t("./events/EventMap"),u=null;r.prototype.subscribe=function(t,e){if(this._assertTargetLoaded(),this._target.preventDefault[t]=e,this._target.subscribe[t]=!0,!this._target.listeners[t]&&!this._root.listeners[t]){var i=h[t][1]?this._root:this._target;i.listeners[t]=this._boundTriggerEvent,i.element.addEventListener(t,this._boundTriggerEvent)}},r.prototype._triggerEvent=function(t){for(var e=t.path?t.path:s(t),i=0;i<e.length;i++)if(e[i].dataset){var r=e[i].dataset.faPath;if(r&&this._elements[r]&&this._elements[r].subscribe[t.type]){t.stopPropagation(),this._elements[r].preventDefault[t.type]&&t.preventDefault();var n=h[t.type][0];this._compositor.sendEvent(r,t.type,new n(t));break}}},r.prototype.getSizeOf=function(t){var e=this._elements[t];if(!e)return null;var i={val:e.size};return this._compositor.sendEvent(t,"resize",i),i},r.prototype.getSize=function(){return this._size[0]=this._root.element.offsetWidth,this._size[1]=this._root.element.offsetHeight,this._size},r.prototype._getSize=r.prototype.getSize,r.prototype.draw=function(t){t.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=t.perspectiveTransform[0],this.perspectiveTransform[1]=t.perspectiveTransform[1],this.perspectiveTransform[2]=t.perspectiveTransform[2],this.perspectiveTransform[3]=t.perspectiveTransform[3],this.perspectiveTransform[4]=t.perspectiveTransform[4],this.perspectiveTransform[5]=t.perspectiveTransform[5],this.perspectiveTransform[6]=t.perspectiveTransform[6],this.perspectiveTransform[7]=t.perspectiveTransform[7],this.perspectiveTransform[8]=t.perspectiveTransform[8],this.perspectiveTransform[9]=t.perspectiveTransform[9],this.perspectiveTransform[10]=t.perspectiveTransform[10],this.perspectiveTransform[11]=t.perspectiveTransform[11],this.perspectiveTransform[12]=t.perspectiveTransform[12],this.perspectiveTransform[13]=t.perspectiveTransform[13],this.perspectiveTransform[14]=t.perspectiveTransform[14],this.perspectiveTransform[15]=t.perspectiveTransform[15]),(t.viewDirty||t.perspectiveDirty)&&(o.multiply(this._VPtransform,this.perspectiveTransform,t.viewTransform),this._root.element.style[u]=this._stringifyMatrix(this._VPtransform))},r.prototype._assertPathLoaded=function(){if(!this._path)throw new Error("path not loaded")},r.prototype._assertParentLoaded=function(){if(!this._parent)throw new Error("parent not loaded")},r.prototype._assertChildrenLoaded=function(){if(!this._children)throw new Error("children not loaded")},r.prototype._assertTargetLoaded=function(){if(!this._target)throw new Error("No target loaded")},r.prototype.findParent=function(){this._assertPathLoaded();for(var t,e=this._path;!t&&e.length;)e=e.substring(0,e.lastIndexOf("/")),t=this._elements[e];return this._parent=t,t},r.prototype.findChildren=function(t){this._assertPathLoaded();var e,i=this._path+"/",r=Object.keys(this._elements),s=0;for(t=t?t:this._children,this._children.length=0;s<r.length;)-1===r[s].indexOf(i)||r[s]===i?r.splice(s,1):s++;var n,o=0;for(s=0;s<r.length;s++)for(n=r[s],o=0;o<r.length;o++)s!==o&&-1!==r[o].indexOf(n)&&(r.splice(o,1),s--);for(s=0,e=r.length;e>s;s++)t[s]=this._elements[r[s]];return t},r.prototype.findTarget=function(){return this._target=this._elements[this._path],this._target},r.prototype.loadPath=function(t){return this._path=t,this._path},r.prototype.insertEl=function(t){if(!this._target||this._target.element.tagName.toLowerCase()!==t.toLowerCase()){this.findParent(),this.findChildren(),this._assertParentLoaded(),this._assertChildrenLoaded(),this._target&&this._parent.element.removeChild(this._target.element),this._target=new n(document.createElement(t),this._path),this._parent.element.appendChild(this._target.element),this._elements[this._path]=this._target;for(var e=0,i=this._children.length;i>e;e++)this._target.element.appendChild(this._children[e].element)}},r.prototype.setProperty=function(t,e){this._assertTargetLoaded(),this._target.element.style[t]=e},r.prototype.setSize=function(t,e){this._assertTargetLoaded(),this.setWidth(t),this.setHeight(e)},r.prototype.setWidth=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitWidth=!0,e&&(e.style.width=""),t=e?e.offsetWidth:0,this._target.element.style.width=t+"px"):(this._target.explicitWidth=!1,e&&(e.style.width=t+"px"),this._target.element.style.width=t+"px"),this._target.size[0]=t},r.prototype.setHeight=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitHeight=!0,e&&(e.style.height=""),t=e?e.offsetHeight:0,this._target.element.style.height=t+"px"):(this._target.explicitHeight=!1,e&&(e.style.height=t+"px"),this._target.element.style.height=t+"px"),this._target.size[1]=t},r.prototype.setAttribute=function(t,e){this._assertTargetLoaded(),this._target.element.setAttribute(t,e)},r.prototype.setContent=function(t){this._assertTargetLoaded(),this.findChildren(),this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=t,this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?!1:this._target.size[1])},r.prototype.setMatrix=function(t){this._assertTargetLoaded(),this.findParent();var e,i,r=this._target.worldTransform,s=!1;if(t)for(e=0,i=16;i>e;e++)s=s?s:r[e]===t[e],r[e]=t[e];else s=!0;if(s){o.invert(this._target.invertedParent,this._parent.worldTransform),o.multiply(this._target.finalTransform,this._target.invertedParent,r);var n=this.findChildren([]),a=this._path,h=this._target;for(e=0,i=n.length;i>e;e++)this._target=n[e],this._path=this._target.path,this.setMatrix();this._path=a,this._target=h}this._target.element.style[u]=this._stringifyMatrix(this._target.finalTransform)},r.prototype.addClass=function(t){this._assertTargetLoaded(),this._target.element.classList.add(t)},r.prototype.removeClass=function(t){this._assertTargetLoaded(),this._target.element.classList.remove(t)},r.prototype._stringifyMatrix=function(t){var e="matrix3d(";return e+=t[0]<1e-6&&t[0]>-1e-6?"0,":t[0]+",",e+=t[1]<1e-6&&t[1]>-1e-6?"0,":t[1]+",",e+=t[2]<1e-6&&t[2]>-1e-6?"0,":t[2]+",",e+=t[3]<1e-6&&t[3]>-1e-6?"0,":t[3]+",",e+=t[4]<1e-6&&t[4]>-1e-6?"0,":t[4]+",",e+=t[5]<1e-6&&t[5]>-1e-6?"0,":t[5]+",",e+=t[6]<1e-6&&t[6]>-1e-6?"0,":t[6]+",",e+=t[7]<1e-6&&t[7]>-1e-6?"0,":t[7]+",",e+=t[8]<1e-6&&t[8]>-1e-6?"0,":t[8]+",",e+=t[9]<1e-6&&t[9]>-1e-6?"0,":t[9]+",",e+=t[10]<1e-6&&t[10]>-1e-6?"0,":t[10]+",",e+=t[11]<1e-6&&t[11]>-1e-6?"0,":t[11]+",",e+=t[12]<1e-6&&t[12]>-1e-6?"0,":t[12]+",",e+=t[13]<1e-6&&t[13]>-1e-6?"0,":t[13]+",",e+=t[14]<1e-6&&t[14]>-1e-6?"0,":t[14]+",",e+=t[15]+")"},e.exports=r},{"../utilities/vendorPrefix":39,"./ElementCache":13,"./Math":14,"./events/EventMap":17}],13:[function(t,e,i){"use strict";function r(t,e){this.element=t,this.path=e,this.content=null,this.size=new Int16Array(3),this.explicitHeight=!1,this.explicitWidth=!1,this.worldTransform=new Float32Array(s),this.invertedParent=new Float32Array(s),this.finalTransform=new Float32Array(s),this.postRenderSize=new Float32Array(2),this.listeners={},this.preventDefault={},this.subscribe={}}var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e.exports=r},{}],14:[function(t,e,i){"use strict";function r(t,e){var i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],h=e[6],u=e[7],p=e[8],l=e[9],c=e[10],f=e[11],d=e[12],m=e[13],_=e[14],g=e[15],y=i*a-r*o,v=i*h-s*o,b=i*u-n*o,w=r*h-s*a,T=r*u-n*a,x=s*u-n*h,E=p*m-l*d,S=p*_-c*d,C=p*g-f*d,R=l*_-c*m,A=l*g-f*m,O=c*g-f*_,z=y*O-v*A+b*R+w*C-T*S+x*E;return z?(z=1/z,t[0]=(a*O-h*A+u*R)*z,t[1]=(s*A-r*O-n*R)*z,t[2]=(m*x-_*T+g*w)*z,t[3]=(c*T-l*x-f*w)*z,t[4]=(h*C-o*O-u*S)*z,t[5]=(i*O-s*C+n*S)*z,t[6]=(_*b-d*x-g*v)*z,t[7]=(p*x-c*b+f*v)*z,t[8]=(o*A-a*C+u*E)*z,t[9]=(r*C-i*A-n*E)*z,t[10]=(d*T-m*b+g*y)*z,t[11]=(l*b-p*T-f*y)*z,t[12]=(a*S-o*R-h*E)*z,t[13]=(i*R-r*S+s*E)*z,t[14]=(m*v-d*w-_*y)*z,t[15]=(p*w-l*v+c*y)*z,t):null}function s(t,e,i){var r,s,n,o,a=e[0],h=e[1],u=e[2],p=e[3],l=e[4],c=e[5],f=e[6],d=e[7],m=e[8],_=e[9],g=e[10],y=e[11],v=e[12],b=e[13],w=e[14],T=e[15],x=i[0],E=i[1],S=i[2],C=i[3],R=i[4],A=i[5],O=i[6],z=i[7],M=i[8],L=i[9],U=i[10],D=i[11],I=i[12],P=i[13],F=i[14],N=i[15],k=!1;return r=x*a+E*l+S*m+C*v,s=x*h+E*c+S*_+C*b,n=x*u+E*f+S*g+C*w,o=x*p+E*d+S*y+C*T,k=k?k:r===t[0]||s===t[1]||n===t[2]||o===t[3],t[0]=r,t[1]=s,t[2]=n,t[3]=o,x=R,E=A,S=O,C=z,r=x*a+E*l+S*m+C*v,s=x*h+E*c+S*_+C*b,n=x*u+E*f+S*g+C*w,o=x*p+E*d+S*y+C*T,k=k?k:r===t[4]||s===t[5]||n===t[6]||o===t[7],t[4]=r,t[5]=s,t[6]=n,t[7]=o,x=M,E=L,S=U,C=D,r=x*a+E*l+S*m+C*v,s=x*h+E*c+S*_+C*b,n=x*u+E*f+S*g+C*w,o=x*p+E*d+S*y+C*T,k=k?k:r===t[8]||s===t[9]||n===t[10]||o===t[11],t[8]=r,t[9]=s,t[10]=n,t[11]=o,x=I,E=P,S=F,C=N,r=x*a+E*l+S*m+C*v,s=x*h+E*c+S*_+C*b,n=x*u+E*f+S*g+C*w,o=x*p+E*d+S*y+C*T,k=k?k:r===t[12]||s===t[13]||n===t[14]||o===t[15],t[12]=r,t[13]=s,t[14]=n,t[15]=o,t}e.exports={multiply:s,invert:r}},{}],15:[function(t,e,i){"use strict";function r(t){s.call(this,t),this.data=t.data}var s=t("./UIEvent");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"CompositionEvent"},e.exports=r},{"./UIEvent":23}],16:[function(t,e,i){"use strict";function r(t){this.type=t.type,this.defaultPrevented=t.defaultPrevented,this.timeStamp=t.timeStamp;var e=t.target.constructor;(e===HTMLInputElement||e===HTMLTextAreaElement||e===HTMLSelectElement)&&(this.value=t.target.value)}r.prototype.toString=function(){return"Event"},e.exports=r},{}],17:[function(t,e,i){"use strict";var r=t("./CompositionEvent"),s=t("./Event"),n=t("./FocusEvent"),o=t("./InputEvent"),a=t("./KeyboardEvent"),h=t("./MouseEvent"),u=t("./TouchEvent"),p=t("./UIEvent"),l=t("./WheelEvent"),c={change:[s,!0],submit:[s,!0],abort:[s,!1],beforeinput:[o,!0],blur:[n,!1],click:[h,!0],compositionend:[r,!0],compositionstart:[r,!0],compositionupdate:[r,!0],dblclick:[h,!0],focus:[n,!1],focusin:[n,!0],focusout:[n,!0],input:[o,!0],keydown:[a,!0],keyup:[a,!0],load:[s,!1],mousedown:[h,!0],mouseenter:[h,!1],mouseleave:[h,!1],mousemove:[h,!1],mouseout:[h,!0],mouseover:[h,!0],mouseup:[h,!0],resize:[p,!1],scroll:[p,!1],select:[s,!0],unload:[s,!1],wheel:[l,!0],touchcancel:[u,!0],touchend:[u,!0],touchmove:[u,!0],touchstart:[u,!0]};e.exports=c},{"./CompositionEvent":15,"./Event":16,"./FocusEvent":18,"./InputEvent":19,"./KeyboardEvent":20,"./MouseEvent":21,"./TouchEvent":22,"./UIEvent":23,"./WheelEvent":24}],18:[function(t,e,i){"use strict";function r(t){s.call(this,t)}var s=t("./UIEvent");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"FocusEvent"},e.exports=r},{"./UIEvent":23}],19:[function(t,e,i){"use strict";function r(t){s.call(this,t),this.inputType=t.inputType,this.data=t.data,this.isComposing=t.isComposing,this.targetRange=t.targetRange}var s=t("./UIEvent");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"InputEvent"},e.exports=r},{"./UIEvent":23}],20:[function(t,e,i){"use strict";function r(t){s.call(this,t),this.DOM_KEY_LOCATION_STANDARD=0,this.DOM_KEY_LOCATION_LEFT=1,this.DOM_KEY_LOCATION_RIGHT=2,this.DOM_KEY_LOCATION_NUMPAD=3,this.key=t.key,this.code=t.code,this.location=t.location,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.repeat=t.repeat,this.isComposing=t.isComposing,this.keyCode=t.keyCode}var s=t("./UIEvent");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"KeyboardEvent"},e.exports=r},{"./UIEvent":23}],21:[function(t,e,i){"use strict";function r(t){s.call(this,t),this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.button=t.button,this.buttons=t.buttons,this.pageX=t.pageX,this.pageY=t.pageY,this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY}var s=t("./UIEvent");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"MouseEvent"},e.exports=r},{"./UIEvent":23}],22:[function(t,e,i){"use strict";function r(t){this.identifier=t.identifier,this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY}function s(t){if(!t)return a;for(var e=[],i=0;i<t.length;i++)e[i]=new r(t[i]);return e}function n(t){o.call(this,t),this.touches=s(t.touches),this.targetTouches=s(t.targetTouches),this.changedTouches=s(t.changedTouches),this.altKey=t.altKey,this.metaKey=t.metaKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey}var o=t("./UIEvent"),a=[];n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"TouchEvent"},e.exports=n},{"./UIEvent":23}],23:[function(t,e,i){"use strict";function r(t){s.call(this,t),this.detail=t.detail}var s=t("./Event");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"UIEvent"},e.exports=r},{"./Event":16}],24:[function(t,e,i){"use strict";function r(t){s.call(this,t),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ,this.deltaMode=t.deltaMode}var s=t("./MouseEvent");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return"WheelEvent"},e.exports=r},{"./MouseEvent":21}],25:[function(t,e,i){"use strict";var r=function(t,e){t instanceof Array||t instanceof Float32Array?(this.x=t[0]||0,this.y=t[1]||0):(this.x=t||0,this.y=e||0)};r.prototype.set=function(t,e){return null!=t&&(this.x=t),null!=e&&(this.y=e),this},r.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.scale=function(t){return t instanceof r?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},r.prototype.rotate=function(t){var e=this.x,i=this.y,r=Math.cos(t),s=Math.sin(t);return this.x=e*r-i*s,this.y=e*s+i*r,this},r.prototype.dot=function(t){return this.x*t.x+this.y*t.y},r.prototype.cross=function(t){return this.x*t.y-this.y*t.x},r.prototype.invert=function(){return this.x*=-1,this.y*=-1,this},r.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this},r.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.clear=function(){return this.x=0,this.y=0,this},r.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0},r.prototype.toArray=function(){return[this.x,this.y]},r.normalize=function(t,e){var i=t.x,r=t.y,s=Math.sqrt(i*i+r*r)||1;return s=1/s,e.x=t.x*s,e.y=t.y*s,e},r.clone=function(t){return new r(t.x,t.y)},r.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},r.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},r.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},r.dot=function(t,e){return t.x*e.x+t.y*e.y},r.cross=function(t,e){return t.x*e.y-t.y*e.x},e.exports=r},{}],26:[function(t,e,i){"use strict";var r=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};r.prototype.set=function(t,e,i){return null!=t&&(this.x=t),null!=e&&(this.y=e),null!=i&&(this.z=i),this},r.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},r.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},r.prototype.rotateX=function(t){var e=this.y,i=this.z,r=Math.cos(t),s=Math.sin(t);return this.y=e*r-i*s,this.z=e*s+i*r,this},r.prototype.rotateY=function(t){var e=this.x,i=this.z,r=Math.cos(t),s=Math.sin(t);return this.x=i*s+e*r,this.z=i*r-e*s,this},r.prototype.rotateZ=function(t){var e=this.x,i=this.y,r=Math.cos(t),s=Math.sin(t);return this.x=e*r-i*s,this.y=e*s+i*r,this},r.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},r.prototype.cross=function(t){var e=this.x,i=this.y,r=this.z,s=t.x,n=t.y,o=t.z;return this.x=i*o-r*n,this.y=r*s-e*o,this.z=e*n-i*s,this},r.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},r.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},r.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this},r.prototype.length=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},r.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},r.prototype.clear=function(){return this.x=0,this.y=0,this.z=0,this},r.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},r.prototype.toArray=function(){return[this.x,this.y,this.z]},r.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,r=Math.sqrt(t*t+e*e+i*i)||1;return r=1/r,this.x*=r,this.y*=r,this.z*=r,this},r.prototype.applyRotation=function(t){var e=t.w,i=-t.x,r=-t.y,s=-t.z,n=this.x,o=this.y,a=this.z,h=-i*n-r*o-s*a,u=n*e+o*s-r*a,p=o*e+i*a-n*s,l=a*e+n*r-i*o,c=e,f=-i,d=-r,m=-s;return this.x=u*c+f*h+d*l-p*m,this.y=p*c+d*h+u*m-f*l,this.z=l*c+m*h+f*p-u*d,this},r.prototype.applyMatrix=function(t){var e=t.get(),i=this.x,r=this.y,s=this.z;return this.x=e[0]*i+e[1]*r+e[2]*s,this.y=e[3]*i+e[4]*r+e[5]*s,this.z=e[6]*i+e[7]*r+e[8]*s,this},r.normalize=function(t,e){var i=t.x,r=t.y,s=t.z,n=Math.sqrt(i*i+r*r+s*s)||1;return n=1/n,e.x=i*n,e.y=r*n,e.z=s*n,e},r.applyRotation=function(t,e,i){var r=e.w,s=-e.x,n=-e.y,o=-e.z,a=t.x,h=t.y,u=t.z,p=-s*a-n*h-o*u,l=a*r+h*o-n*u,c=h*r+s*u-a*o,f=u*r+a*n-s*h,d=r,m=-s,_=-n,g=-o;return i.x=l*d+m*p+_*f-c*g,i.y=c*d+_*p+l*g-m*f,i.z=f*d+g*p+m*c-l*_,i},r.clone=function(t){return new r(t.x,t.y,t.z)},r.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i},r.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i},r.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i},r.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},r.cross=function(t,e,i){var r=t.x,s=t.y,n=t.z,o=e.x,a=e.y,h=e.z;return i.x=s*h-n*a,i.y=n*o-r*h,i.z=r*a-s*o,i},r.project=function(t,e,i){var r=t.x,s=t.y,n=t.z,o=e.x,a=e.y,h=e.z,u=r*o+s*a+n*h;return u/=o*o+a*a+h*h,i.x=o*u,i.y=a*u,i.z=h*u,i},e.exports=r},{}],27:[function(t,e,i){function r(){throw new Error("You should bundle your code using `glslify` as a transform.")}e.exports=r},{}],28:[function(t,e,i){function r(t,e,i,r){return{vertex:t,fragment:e,uniforms:i,attributes:r}}e.exports=r},{}],29:[function(t,e,i){"use strict";var r,s,n=0,o=["ms","moz","webkit","o"];if("object"==typeof window){r=window.requestAnimationFrame,s=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(var a=0;a<o.length&&!r;++a)r=window[o[a]+"RequestAnimationFrame"],s=window[o[a]+"CancelRequestAnimationFrame"]||window[o[a]+"CancelAnimationFrame"];r&&!s&&(r=null)}if(!r){var h=Date.now?Date.now:function(){return(new Date).getTime()};r=function(t){var e=h(),i=Math.max(0,16-(e-n)),r=setTimeout(function(){t(e+i)},i);return n=e+i,r},s=function(t){clearTimeout(t)}}var u={requestAnimationFrame:r,cancelAnimationFrame:s};e.exports=u},{}],30:[function(t,e,i){"use strict";e.exports={requestAnimationFrame:t("./animationFrame").requestAnimationFrame,cancelAnimationFrame:t("./animationFrame").cancelAnimationFrame}},{"./animationFrame":29}],31:[function(t,e,i){"use strict";function r(){var t=this;this._updates=[],this._looper=function(e){t.loop(e)},this._time=0,this._stoppedAt=0,this._sleep=0,this._startOnVisibilityChange=!0,this._rAF=null,this._sleepDiff=!0,this.start(),a&&document.addEventListener(u,function(){t._onVisibilityChange()})}var s=t("../polyfills"),n=s.requestAnimationFrame,o=s.cancelAnimationFrame,a="undefined"!=typeof document;if(a){var h,u;"undefined"!=typeof document.hidden?(h="hidden",u="visibilitychange"):"undefined"!=typeof document.mozHidden?(h="mozHidden",u="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(h="msHidden",u="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(h="webkitHidden",u="webkitvisibilitychange")}r.prototype._onVisibilityChange=function(){document[h]?this._onUnfocus():this._onFocus()},r.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()},r.prototype._onUnfocus=function(){this._stop()},r.prototype.start=function(){return this._running||(this._startOnVisibilityChange=!0,this._start()),this},r.prototype._start=function(){this._running=!0,this._sleepDiff=!0,this._rAF=n(this._looper)},r.prototype.stop=function(){return this._running&&(this._startOnVisibilityChange=!1,this._stop()),this},r.prototype._stop=function(){this._running=!1,this._stoppedAt=this._time,o(this._rAF)},r.prototype.isRunning=function(){return this._running},r.prototype.step=function(t){this._time=t,this._sleepDiff&&(this._sleep+=t-this._stoppedAt,this._sleepDiff=!1);for(var e=t-this._sleep,i=0,r=this._updates.length;r>i;i++)this._updates[i].update(e);return this},r.prototype.loop=function(t){return this.step(t),this._rAF=n(this._looper),this},r.prototype.update=function(t){return-1===this._updates.indexOf(t)&&this._updates.push(t),this},r.prototype.noLongerUpdate=function(t){var e=this._updates.indexOf(t);return e>-1&&this._updates.splice(e,1),this},e.exports=r},{"../polyfills":30}],32:[function(t,e,i){"use strict";function r(){n(),this._contexts={},this._outCommands=[],this._inCommands=[],this._time=null,this._resized=!1;var t=this;window.addEventListener("resize",function(){t._resized=!0})}var s=t("./Context"),n=t("./inject-css");r.prototype.getTime=function(){return this._time},r.prototype.sendEvent=function(t,e,i){this._outCommands.push("WITH",t,"TRIGGER",e,i)},r.prototype.sendResize=function(t,e){this.sendEvent(t,"CONTEXT_RESIZE",e)},r.prototype.handleWith=function(t,e){var i=e[t],r=i.split("/"),s=this.getOrSetContext(r.shift());return s.receive(i,e,t)},r.prototype.getOrSetContext=function(t){if(this._contexts[t])return this._contexts[t];var e=new s(t,this);return this._contexts[t]=e,e},r.prototype.giveSizeFor=function(t,e){var i=e[t],r=this.getOrSetContext(i).getRootSize();this.sendResize(i,r)},r.prototype.drawCommands=function(){for(var t=this._inCommands,e=0,i=t[e];i;){switch(i){case"TIME":this._time=t[++e];break;case"WITH":e=this.handleWith(++e,t);break;case"NEED_SIZE_FOR":this.giveSizeFor(++e,t)}i=t[++e]}for(var r in this._contexts)this._contexts[r].draw();return this._resized&&this.updateSize(),this._outCommands},r.prototype.updateSize=function(){for(var t in this._contexts)this._contexts[t].updateSize()},r.prototype.receiveCommands=function(t){for(var e=t.length,i=0;e>i;i++)this._inCommands.push(t[i])},r.prototype.clearCommands=function(){this._inCommands.length=0,this._outCommands.length=0,this._resized=!1},e.exports=r},{"./Context":33,"./inject-css":35}],33:[function(t,e,i){"use strict";function r(t,e){this._compositor=e,this._rootEl=document.querySelector(t),this._selector=t;var i=document.createElement("div");this._rootEl.appendChild(i),this.DOMRenderer=new o(i,t,e),this.WebGLRenderer=null,this.canvas=null,this._renderState={projectionType:n.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1},this._size=[],this._children={},this._elementHash={},this._meshTransform=[],this._meshSize=[0,0,0]}var s=t("../webgl-renderers/WebGLRenderer"),n=t("../components/Camera"),o=t("../dom-renderers/DOMRenderer");r.prototype.updateSize=function(){var t=this.DOMRenderer.getSize();return this._compositor.sendResize(this._selector,t),this.canvas&&this.WebGLRenderer&&this.WebGLRenderer.updateSize(t),this},r.prototype.draw=function(){this.DOMRenderer.draw(this._renderState),this.WebGLRenderer&&this.WebGLRenderer.draw(this._renderState),this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1),this._renderState.viewDirty&&(this._renderState.viewDirty=!1)},r.prototype.getRootSize=function(){return this.DOMRenderer.getSize()},r.prototype.initWebGL=function(){this.canvas=document.createElement("canvas"),this._rootEl.appendChild(this.canvas),this.WebGLRenderer=new s(this.canvas,this._compositor),this.updateSize()},r.prototype.receive=function(t,e,i){var r=i,s=e[++r];for(this.DOMRenderer.loadPath(t),this.DOMRenderer.findTarget();s;){switch(s){case"INIT_DOM":this.DOMRenderer.insertEl(e[++r]);break;case"DOM_RENDER_SIZE":this.DOMRenderer.getSizeOf(e[++r]);break;case"CHANGE_TRANSFORM":for(var o=0;16>o;o++)this._meshTransform[o]=e[++r];this.DOMRenderer.setMatrix(this._meshTransform),this.WebGLRenderer&&this.WebGLRenderer.setCutoutUniform(t,"u_transform",this._meshTransform);break;case"CHANGE_SIZE":var a=e[++r],h=e[++r];this.DOMRenderer.setSize(a,h),this.WebGLRenderer&&(this._meshSize[0]=a,this._meshSize[1]=h,this.WebGLRenderer.setCutoutUniform(t,"u_size",this._meshSize));break;case"CHANGE_PROPERTY":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setProperty(e[++r],e[++r]);break;case"CHANGE_CONTENT":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setContent(e[++r]);break;case"CHANGE_ATTRIBUTE":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setAttribute(e[++r],e[++r]);break;case"ADD_CLASS":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.addClass(e[++r]);break;case"REMOVE_CLASS":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.removeClass(e[++r]);break;case"SUBSCRIBE":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.subscribe(e[++r],e[++r]);break;case"GL_SET_DRAW_OPTIONS":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshOptions(t,e[++r]);break;case"GL_AMBIENT_LIGHT":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setAmbientLightColor(t,e[++r],e[++r],e[++r]);break;case"GL_LIGHT_POSITION":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setLightPosition(t,e[++r],e[++r],e[++r]);break;case"GL_LIGHT_COLOR":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setLightColor(t,e[++r],e[++r],e[++r]);break;case"MATERIAL_INPUT":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.handleMaterialInput(t,e[++r],e[++r]);break;case"GL_SET_GEOMETRY":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setGeometry(t,e[++r],e[++r],e[++r]);break;case"GL_UNIFORMS":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshUniform(t,e[++r],e[++r]);break;case"GL_BUFFER_DATA":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.bufferData(t,e[++r],e[++r],e[++r],e[++r],e[++r]);break;case"GL_CUTOUT_STATE":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setCutoutState(t,e[++r]);break;case"GL_MESH_VISIBILITY":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshVisibility(t,e[++r]);break;case"GL_REMOVE_MESH":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.removeMesh(t);break;case"PINHOLE_PROJECTION":this._renderState.projectionType=n.PINHOLE_PROJECTION,this._renderState.perspectiveTransform[11]=-1/e[++r],this._renderState.perspectiveDirty=!0;break;case"ORTHOGRAPHIC_PROJECTION":this._renderState.projectionType=n.ORTHOGRAPHIC_PROJECTION,this._renderState.perspectiveTransform[11]=0,this._renderState.perspectiveDirty=!0;break;case"CHANGE_VIEW_TRANSFORM":this._renderState.viewTransform[0]=e[++r],this._renderState.viewTransform[1]=e[++r],this._renderState.viewTransform[2]=e[++r],this._renderState.viewTransform[3]=e[++r],this._renderState.viewTransform[4]=e[++r],this._renderState.viewTransform[5]=e[++r],this._renderState.viewTransform[6]=e[++r],this._renderState.viewTransform[7]=e[++r],this._renderState.viewTransform[8]=e[++r],this._renderState.viewTransform[9]=e[++r],this._renderState.viewTransform[10]=e[++r],this._renderState.viewTransform[11]=e[++r],this._renderState.viewTransform[12]=e[++r],this._renderState.viewTransform[13]=e[++r],this._renderState.viewTransform[14]=e[++r],this._renderState.viewTransform[15]=e[++r],this._renderState.viewDirty=!0;break;case"WITH":return r-1}s=e[++r]}return r},e.exports=r},{"../components/Camera":1,"../dom-renderers/DOMRenderer":12,"../webgl-renderers/WebGLRenderer":49}],34:[function(t,e,i){"use strict";function r(t,e,i){this._thread=t,this._compositor=e,this._renderLoop=i,this._renderLoop.update(this);var r=this;this._thread.onmessage=function(t){var e=t.data?t.data:t;if("ENGINE"===e[0])switch(e[1]){case"START":r._renderLoop.start();break;case"STOP":r._renderLoop.stop();break;default:console.error('Unknown ENGINE command "'+e[1]+'"')}else r._compositor.receiveCommands(e)},this._thread.onerror=function(t){console.error(t)}}r.prototype.getThread=function(){return this._thread},r.prototype.getCompositor=function(){return this._compositor},r.prototype.getEngine=function(){return this._renderLoop},r.prototype.update=function(t){this._thread.postMessage(["FRAME",t]);var e=this._compositor.drawCommands();this._thread.postMessage(e),this._compositor.clearCommands()},e.exports=r},{}],35:[function(t,e,i){"use strict";function r(){if(!n)if(n=!0,document.createStyleSheet){var t=document.createStyleSheet();t.cssText=s}else{var e=document.getElementsByTagName("head")[0],i=document.createElement("style");i.styleSheet?i.styleSheet.cssText=s:i.appendChild(document.createTextNode(s)),(e?e:document.documentElement).appendChild(i)}}var s=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}",n="undefined"==typeof document;e.exports=r},{}],36:[function(t,e,i){"use strict";function r(){this._events={}}r.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];
return i.push(e),function(){i.splice(i.indexOf(e),1)}},r.prototype.off=function(t,e){var i=this._events[t];return i&&i.splice(i.indexOf(e),1),this},r.prototype.trigger=function(t,e){var i=this._events[t];if(i)for(var r=0,s=i.length;s>r;r++)i[r](e);return this},e.exports=r},{}],37:[function(t,e,i){"use strict";var r=function t(e){var i;if("object"==typeof e){i=e instanceof Array?[]:{};for(var r in e)if("object"==typeof e[r]&&null!==e[r])if(e[r]instanceof Array){i[r]=new Array(e[r].length);for(var s=0;s<e[r].length;s++)i[r][s]=t(e[r][s])}else i[r]=t(e[r]);else i[r]=e[r]}else i=e;return i};e.exports=r},{}],38:[function(t,e,i){"use strict";e.exports=function(t){var e=[],i=[],r=0;for(var s in t)t.hasOwnProperty(s)&&(e[r]=s,i[r]=t[s],r++);return{keys:e,values:i}}},{}],39:[function(t,e,i){"use strict";function r(t){for(var e=0;e<s.length;e++){var i=s[e]+t;if(""===document.documentElement.style[i])return i}return t}var s=["","-ms-","-webkit-","-moz-","-o-"];e.exports=r},{}],40:[function(t,e,i){"use strict";function r(t){if(this.options=t||{},this.DEFAULT_BUFFER_SIZE=3,this.spec={id:s++,dynamic:!1,type:this.options.type||"TRIANGLES",bufferNames:[],bufferValues:[],bufferSpacings:[],invalidations:[]},this.options.buffers)for(var e=this.options.buffers.length,i=0;e>i;)this.spec.bufferNames.push(this.options.buffers[i].name),this.spec.bufferValues.push(this.options.buffers[i].data),this.spec.bufferSpacings.push(this.options.buffers[i].size||this.DEFAULT_BUFFER_SIZE),this.spec.invalidations.push(i++)}var s=0;e.exports=r},{}],41:[function(t,e,i){"use strict";function r(t,e){return-(e+(t-e)/2)}function s(t,e){return 1/((t-e)/2)}var n=t("../math/Vec3"),o=t("../math/Vec2"),a=[new n,new n,new n,new o,new o],h={};h.generateParametric=function(t,e,i,r){var s,n,o,a,h=[],u=r?Math.PI+Math.PI/(t-1):Math.PI,p=[];for(s=0;t+1>s;s++)for(n=s*u/t,a=0;e>a;a++)o=2*a*u/e,i(n,o,p),h.push(p[0],p[1],p[2]);var l,c=[],f=0;for(s=0;t>s;s++){for(a=0;e>a;a++)l=(a+1)%e,c.push(f+a,f+a+e,f+l),c.push(f+l,f+a+e,f+l+e);f+=e}return{vertices:h,indices:c}},h.computeNormals=function(t,e,i){var r,s,n,o,h,u,p,l,c,f,d=i||[],m=e.length/3;for(u=0;m>u;u++)s=3*e[3*u+0],r=3*e[3*u+1],n=3*e[3*u+2],a[0].set(t[r],t[r+1],t[r+2]),a[1].set(t[s],t[s+1],t[s+2]),a[2].set(t[n],t[n+1],t[n+2]),o=a[2].subtract(a[0]).cross(a[1].subtract(a[0])).normalize(),d[r+0]=(d[r+0]||0)+o.x,d[r+1]=(d[r+1]||0)+o.y,d[r+2]=(d[r+2]||0)+o.z,d[s+0]=(d[s+0]||0)+o.x,d[s+1]=(d[s+1]||0)+o.y,d[s+2]=(d[s+2]||0)+o.z,d[n+0]=(d[n+0]||0)+o.x,d[n+1]=(d[n+1]||0)+o.y,d[n+2]=(d[n+2]||0)+o.z;for(u=0;u<d.length;u+=3)for(p=d[u],l=d[u+1],c=d[u+2],f=Math.sqrt(p*p+l*l+c*c),h=0;3>h;h++)d[u+h]/=f;return d},h.subdivide=function(t,e,i){for(var r,s,h,u,p,l,c=t.length/3;c--;)r=t.slice(3*c,3*c+3),p=r.map(function(t){return new n(e[3*t],e[3*t+1],e[3*t+2])}),e.push.apply(e,n.scale(n.add(p[0],p[1],a[0]),.5,a[1]).toArray()),e.push.apply(e,n.scale(n.add(p[1],p[2],a[0]),.5,a[1]).toArray()),e.push.apply(e,n.scale(n.add(p[0],p[2],a[0]),.5,a[1]).toArray()),i&&(l=r.map(function(t){return new o(i[2*t],i[2*t+1])}),i.push.apply(i,o.scale(o.add(l[0],l[1],a[3]),.5,a[4]).toArray()),i.push.apply(i,o.scale(o.add(l[1],l[2],a[3]),.5,a[4]).toArray()),i.push.apply(i,o.scale(o.add(l[0],l[2],a[3]),.5,a[4]).toArray())),s=e.length-3,h=s+1,u=s+2,t.push(s,h,u),t.push(r[0],s,u),t.push(s,r[1],h),t[c]=u,t[c+1]=h,t[c+2]=r[2]},h.getUniqueFaces=function(t,e){for(var i,r=e.length/3,s=[];r--;)for(var n=0;3>n;n++)i=e[3*r+n],s[i]?(t.push(t[3*i],t[3*i+1],t[3*i+2]),e[3*r+n]=t.length/3-1):s[i]=!0},h.subdivideSpheroid=function(t,e){for(var i,r,s,o,h,u=e.length/3;u--;)r=e.slice(3*u,3*u+3),i=r.map(function(e){return new n(t[3*e],t[3*e+1],t[3*e+2])}),t.push.apply(t,n.normalize(n.add(i[0],i[1],a[0]),a[1]).toArray()),t.push.apply(t,n.normalize(n.add(i[1],i[2],a[0]),a[1]).toArray()),t.push.apply(t,n.normalize(n.add(i[0],i[2],a[0]),a[1]).toArray()),s=t.length/3-3,o=s+1,h=s+2,e.push(s,o,h),e.push(r[0],s,h),e.push(s,r[1],o),e[3*u]=h,e[3*u+1]=o,e[3*u+2]=r[2]},h.getSpheroidNormals=function(t,e){e=e||[];for(var i,r=t.length/3,s=0;r>s;s++)i=new n(t[3*s+0],t[3*s+1],t[3*s+2]).normalize().toArray(),e[3*s+0]=i[0],e[3*s+1]=i[1],e[3*s+2]=i[2];return e},h.getSpheroidUV=function(t,e){e=e||[];for(var i,r=t.length/3,s=[],n=0;r>n;n++)i=a[0].set(t[3*n],t[3*n+1],t[3*n+2]).normalize().toArray(),s[0]=.5*this.getAzimuth(i)/Math.PI+.5,s[1]=this.getAltitude(i)/Math.PI+.5,e.push.apply(e,s);return e},h.normalizeAll=function(t,e){e=e||[];for(var i=t.length/3,r=0;i>r;r++)Array.prototype.push.apply(e,new n(t[3*r],t[3*r+1],t[3*r+2]).normalize().toArray());return e},h.normalizeVertices=function(t,e){e=e||[];var i,o,a,h,u,p,l,c,f=t.length/3,d=[];for(c=0;f>c;c++)l=d[c]=new n(t[3*c],t[3*c+1],t[3*c+2]),(null==i||l.x<i)&&(i=l.x),(null==o||l.x>o)&&(o=l.x),(null==a||l.y<a)&&(a=l.y),(null==h||l.y>h)&&(h=l.y),(null==u||l.z<u)&&(u=l.z),(null==p||l.z>p)&&(p=l.z);var m=new n(r(o,i),r(h,a),r(p,u)),_=Math.min(s(o+m.x,i+m.x),s(h+m.y,a+m.y),s(p+m.z,u+m.z));for(c=0;c<d.length;c++)e.push.apply(e,d[c].add(m).scale(_).toArray());return e},h.getAzimuth=function(t){return Math.atan2(t[2],-t[0])},h.getAltitude=function(t){return Math.atan2(-t[1],Math.sqrt(t[0]*t[0]+t[2]*t[2]))},h.trianglesToLines=function(t,e){var i=t.length/3;e=e||[];var r;for(r=0;i>r;r++)e.push(t[3*r+0],t[3*r+1]),e.push(t[3*r+1],t[3*r+2]),e.push(t[3*r+2],t[3*r+0]);return e},h.addBackfaceTriangles=function(t,e){for(var i=e.length/3,r=0,s=e.length;s--;)e[s]>r&&(r=e[s]);for(r++,s=0;i>s;s++){var n=e[3*s],o=e[3*s+1],a=e[3*s+2];e.push(n+r,a+r,o+r)}var h=t.length;for(s=0;h>s;s++)t.push(t[s])},e.exports=h},{"../math/Vec2":25,"../math/Vec3":26}],42:[function(t,e,i){"use strict";function r(t){t=t||{};for(var e,i=t.detailX||t.detail||1,r=t.detailY||t.detail||1,o=[],a=[],h=[],u=[],p=0;r>=p;p++)for(var l=p/r,c=0;i>=c;c++){var f=c/i;o.push(2*(f-.5),2*(l-.5),0),a.push(f,1-l),i>c&&r>p&&(e=c+p*(i+1),u.push(e,e+1,e+i+1),u.push(e+i+1,e+1,e+i+2))}if(t.backface!==!1){n.addBackfaceTriangles(o,u);var d=a.length;for(e=0;d>e;e++)a.push(a[e])}return h=n.computeNormals(o,u),new s({buffers:[{name:"a_pos",data:o},{name:"a_texCoord",data:a,size:2},{name:"a_normals",data:h},{name:"indices",data:u,size:1}]})}var s=t("../Geometry"),n=t("../GeometryHelper");e.exports=r},{"../Geometry":40,"../GeometryHelper":41}],43:[function(t,e,i){"use strict";function r(t,e,i){this.buffer=null,this.target=t,this.type=e,this.data=[],this.gl=i}r.prototype.subData=function(){for(var t=this.gl,e=[],i=0,r=1e4;i<this.data.length;i+=r)e=Array.prototype.concat.apply(e,this.data.slice(i,i+r));this.buffer=this.buffer||t.createBuffer(),t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(e),t.STATIC_DRAW)},e.exports=r},{}],44:[function(t,e,i){"use strict";function r(t){this.gl=t,this.registry={},this._dynamicBuffers=[],this._staticBuffers=[],this._arrayBufferMax=3e4,this._elementBufferMax=3e4}var s="indices",n=t("./Buffer");r.prototype.allocate=function(t,e,i,r,o){var a,h,u,p,l=this.registry[t]||(this.registry[t]={keys:[],values:[],spacing:[],offset:[],length:[]}),c=l.keys.indexOf(e),f=e===s,d=!1,m=0;if(-1===c){if(c=l.keys.length,h=f?i.length:Math.floor(i.length/r),o)u=new n(f?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,f?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:u,offset:i.length,isIndex:f});else{for(p=0;p<this._staticBuffers.length;p++)if(f===this._staticBuffers[p].isIndex&&(a=this._staticBuffers[p].offset+i.length,!f&&a<this._arrayBufferMax||f&&a<this._elementBufferMax)){u=this._staticBuffers[p].buffer,m=this._staticBuffers[p].offset,this._staticBuffers[p].offset+=i.length,d=!0;break}d||(u=new n(f?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,f?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:u,offset:i.length,isIndex:f}))}l.keys.push(e),l.values.push(u),l.spacing.push(r),l.offset.push(m),l.length.push(h)}var _=i.length;for(p=0;_>p;p++)l.values[c].data[m+p]=i[p];l.values[c].subData()},e.exports=r},{"./Buffer":43}],45:[function(t,e,i){"use strict";function r(t,e){return function(){var i=t.apply(this,arguments);return e.apply(this,arguments),i}}function s(t,e){var i="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}",r=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(r),r.textContent=i;var s=document.createElement("ul");s.setAttribute("id","shaderReport"),document.body.appendChild(s);for(var n,o=/ERROR: [\d]+:([\d]+): (.+)/gim,a=e.split("\n");null!=(n=o.exec(t));){n.index===o.lastIndex&&o.lastIndex++;var h=document.createElement("li"),u='<p><span>ERROR</span> "'+n[2]+'" in line '+n[1]+"</p>";u+="<p><b>"+a[n[1]-1].replace(/^[ \t]+/g,"")+"</b></p>",h.innerHTML=u,s.appendChild(h)}}e.exports=function(){return r(this.gl.compileShader,function(t){if(!this.getShaderParameter(t,this.COMPILE_STATUS)){var e=this.getShaderInfoLog(t),i=this.getShaderSource(t);s(e,i)}})}},{}],46:[function(t,e,i){"use strict";function r(t,e){this.gl=t,this.textureSlots=1,this.options=e||{},this.registeredMaterials={},this.flaggedUniforms=[],this.cachedUniforms={},this.uniformTypes=[],this.definitionVec4=[],this.definitionVec3=[],this.definitionFloat=[],this.applicationVec3=[],this.applicationVec4=[],this.applicationFloat=[],this.applicationVert=[],this.definitionVert=[],this.resetProgram()}var s=t("../utilities/clone"),n=t("../utilities/keyValueToArrays"),o=t("../webgl-shaders").vertex,a=t("../webgl-shaders").fragment,h=t("./Debug"),u=35633,p=35632,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c="precision mediump float;\n",f={undefined:"float ",1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},d={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},m={vert:1,vec3:2,vec4:4,float:8},_=n({u_perspective:l,u_view:l,u_resolution:[0,0,0],u_transform:l,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:l,u_lightColor:l,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),g=n({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,0,0]}),y=n({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});r.prototype.registerMaterial=function(t,e){var i=e,r=d[t],s=m[r];if((this.registeredMaterials[e._id]&s)===s)return this;var n;for(n in i.uniforms)-1===_.keys.indexOf(n)&&(_.keys.push(n),_.values.push(i.uniforms[n]));for(n in i.varyings)-1===y.keys.indexOf(n)&&(y.keys.push(n),y.values.push(i.varyings[n]));for(n in i.attributes)-1===g.keys.indexOf(n)&&(g.keys.push(n),g.values.push(i.attributes[n]));return this.registeredMaterials[e._id]|=s,"float"===r&&(this.definitionFloat.push(e.defines),this.definitionFloat.push("float fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+e._id+") return fa_"+e._id+"();")),"vec3"===r&&(this.definitionVec3.push(e.defines),this.definitionVec3.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vec4"===r&&(this.definitionVec4.push(e.defines),this.definitionVec4.push("vec4 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vert"===r&&(this.definitionVert.push(e.defines),this.definitionVert.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),this.resetProgram()},r.prototype.resetProgram=function(){var t,e,i,r,n,h,l=[c],d=[c];for(this.uniformLocations=[],this.attributeLocations={},this.uniformTypes={},this.attributeNames=s(g.keys),this.attributeValues=s(g.values),this.varyingNames=s(y.keys),this.varyingValues=s(y.values),this.uniformNames=s(_.keys),this.uniformValues=s(_.values),this.flaggedUniforms=[],this.cachedUniforms={},d.push("uniform sampler2D u_textures[7];\n"),this.applicationVert.length&&l.push("uniform sampler2D u_textures[7];\n"),h=0;h<this.uniformNames.length;h++)r=this.uniformNames[h],n=this.uniformValues[h],l.push("uniform "+f[n.length]+r+";\n"),d.push("uniform "+f[n.length]+r+";\n");for(h=0;h<this.attributeNames.length;h++)r=this.attributeNames[h],n=this.attributeValues[h],l.push("attribute "+f[n.length]+r+";\n");for(h=0;h<this.varyingNames.length;h++)r=this.varyingNames[h],n=this.varyingValues[h],l.push("varying "+f[n.length]+r+";\n"),d.push("varying "+f[n.length]+r+";\n");e=l.join("")+o.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n")),t=d.join("")+a.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n")),i=this.gl.createProgram(),this.gl.attachShader(i,this.compileShader(this.gl.createShader(u),e)),this.gl.attachShader(i,this.compileShader(this.gl.createShader(p),t)),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.program=i,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(i)),this.program=null),this.setUniforms(this.uniformNames,this.uniformValues);var m=this.gl.getUniformLocation(this.program,"u_textures[0]");return this.gl.uniform1iv(m,[0,1,2,3,4,5,6]),this},r.prototype.uniformIsCached=function(t,e){if(null==this.cachedUniforms[t])return e.length?this.cachedUniforms[t]=new Float32Array(e):this.cachedUniforms[t]=e,!1;if(e.length){for(var i=e.length;i--;)if(e[i]!==this.cachedUniforms[t][i]){for(i=e.length;i--;)this.cachedUniforms[t][i]=e[i];return!1}}else if(this.cachedUniforms[t]!==e)return this.cachedUniforms[t]=e,!1;return!0},r.prototype.setUniforms=function(t,e){var i,r,s,n,o,a=this.gl;if(!this.program)return this;for(n=t.length,o=0;n>o;o++)if(s=t[o],r=e[o],i=this.uniformLocations[s],null!==i&&(void 0===i&&(i=a.getUniformLocation(this.program,s),this.uniformLocations[s]=i),!this.uniformIsCached(s,r)))switch(this.uniformTypes[s]||(this.uniformTypes[s]=this.getUniformTypeFromValue(r)),this.uniformTypes[s]){case"uniform4fv":a.uniform4fv(i,r);break;case"uniform3fv":a.uniform3fv(i,r);break;case"uniform2fv":a.uniform2fv(i,r);break;case"uniform1fv":a.uniform1fv(i,r);break;case"uniform1f":a.uniform1f(i,r);break;case"uniformMatrix3fv":a.uniformMatrix3fv(i,!1,r);break;case"uniformMatrix4fv":a.uniformMatrix4fv(i,!1,r)}return this},r.prototype.getUniformTypeFromValue=function(t){if(Array.isArray(t)||t instanceof Float32Array)switch(t.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(t))&&isFinite(t))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(t)},r.prototype.compileShader=function(t,e){var i=1;return this.options.debug&&(this.gl.compileShader=h.call(this)),this.gl.shaderSource(t,e),this.gl.compileShader(t),this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(t)),console.error("1: "+e.replace(/\n/g,function(){return"\n"+(i+=1)+": "}))),t},e.exports=r},{"../utilities/clone":37,"../utilities/keyValueToArrays":38,"../webgl-shaders":53,"./Debug":45}],47:[function(t,e,i){"use strict";function r(t,e){e=e||{},this.id=t.createTexture(),this.width=e.width||0,this.height=e.height||0,this.mipmap=e.mipmap,this.format=e.format||"RGBA",this.type=e.type||"UNSIGNED_BYTE",this.gl=t,this.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipYWebgl||!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlphaWebgl||!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[e.magFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[e.minFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[e.wrapS]||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[e.wrapT]||t.CLAMP_TO_EDGE)}r.prototype.bind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this},r.prototype.unbind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,null),this},r.prototype.setImage=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],t),this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this},r.prototype.setArray=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],t),this},r.prototype.readBack=function(t,e,i,r){var s,n=this.gl;t=t||0,e=e||0,i=i||this.width,r=r||this.height;var o=n.createFramebuffer();return n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.id,0),n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(i*r*4),n.readPixels(t,e,i,r,n.RGBA,n.UNSIGNED_BYTE,s)),s},e.exports=r},{}],48:[function(t,e,i){"use strict";function r(t){this.registry=[],this._needsResample=[],this._activeTexture=0,this._boundTexture=null,this._checkerboard=o(),this.gl=t}function s(t,e){var i=("string"==typeof t?new Image:t)||{};return i.crossOrigin="anonymous",i.src||(i.src=t),i.complete?e(i):i.onload=function(){e(i)},i}var n=t("./Texture"),o=t("./createCheckerboard");r.prototype.update=function(t){for(var e=this.registry.length,i=1;e>i;i++){var r=this.registry[i];r&&r.isLoaded&&r.resampleRate&&(!r.lastResample||t-r.lastResample>r.resampleRate)&&(this._needsResample[r.id]||(this._needsResample[r.id]=!0,r.lastResample=t))}},r.prototype.register=function(t,e){var i,r=this,o=t.data,a=t.id,h=t.options||{},u=this.registry[a];return u||(u=new n(this.gl,h),u.setImage(this._checkerboard),i=this.registry[a]={resampleRate:h.resampleRate||null,lastResample:null,isLoaded:!1,texture:u,source:o,id:a,slot:e},Array.isArray(o)||o instanceof Uint8Array||o instanceof Float32Array?(this.bindTexture(a),u.setArray(o),i.isLoaded=!0):window&&o instanceof window.HTMLVideoElement?o.addEventListener("loadeddata",function(){r.bindTexture(a),u.setImage(o),i.isLoaded=!0,i.source=o}):"string"==typeof o&&s(o,function(t){r.bindTexture(a),u.setImage(t),i.isLoaded=!0,i.source=t})),a},r.prototype.bindTexture=function(t){var e=this.registry[t];this._activeTexture!==e.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+e.slot),this._activeTexture=e.slot),this._boundTexture!==t&&(this._boundTexture=t,e.texture.bind()),this._needsResample[e.id]&&(e.texture.setImage(e.source),this._needsResample[e.id]=!1)},e.exports=r},{"./Texture":47,"./createCheckerboard":51}],49:[function(t,e,i){"use strict";function r(t,e){t.classList.add("famous-webgl-renderer"),this.canvas=t,this.compositor=e;var i=this.gl=this.getWebGLContext(this.canvas);i.clearColor(0,0,0,0),i.polygonOffset(.1,.1),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.depthFunc(i.LEQUAL),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.CULL_FACE),i.cullFace(i.BACK),this.meshRegistry={},this.meshRegistryKeys=[],this.cutoutRegistry={},this.cutoutRegistryKeys=[],this.numLights=0,this.ambientLightColor=[0,0,0],this.lightRegistry={},this.lightRegistryKeys=[],this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.textureManager=new u(i),this.texCache={},this.bufferRegistry=new n(i),this.program=new s(i,{debug:!0}),this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]},this.resolutionName=["u_resolution"],this.resolutionValues=[],this.cachedSize=[],this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1e-6,0,-1,1,0,1];var r=this.cutoutGeometry=new o;this.bufferRegistry.allocate(r.spec.id,"a_pos",r.spec.bufferValues[0],3),this.bufferRegistry.allocate(r.spec.id,"a_texCoord",r.spec.bufferValues[1],2),this.bufferRegistry.allocate(r.spec.id,"a_normals",r.spec.bufferValues[2],3),this.bufferRegistry.allocate(r.spec.id,"indices",r.spec.bufferValues[3],1)}var s=t("./Program"),n=t("./BufferRegistry"),o=t("../webgl-geometries/primitives/Plane"),a=t("./radixSort"),h=t("../utilities/keyValueToArrays"),u=t("./TextureManager"),p=t("./compileMaterial"),l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c=h({u_numLights:0,u_ambientLight:new Array(3),u_lightPosition:new Array(3),u_lightColor:new Array(3),u_perspective:new Array(16),u_time:0,u_view:new Array(16)});r.prototype.getWebGLContext=function(t){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,r=0;r<e.length;r++){try{i=t.getContext(e[r])}catch(t){var s="Error creating WebGL context: "+t.prototype.toString();console.error(s)}if(i)break}return i?i:!1},r.prototype.createLight=function(t){return this.numLights++,this.lightRegistryKeys.push(t),this.lightRegistry[t]={color:[0,0,0],position:[0,0,0]},this.lightRegistry[t]},r.prototype.createMesh=function(t){this.meshRegistryKeys.push(t);var e=h({u_opacity:1,u_transform:l,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]});return this.meshRegistry[t]={depth:null,uniformKeys:e.keys,uniformValues:e.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0},this.meshRegistry[t]},r.prototype.setCutoutState=function(t,e){var i=this.getOrSetCutout(t);i.visible=e},r.prototype.getOrSetCutout=function(t){if(this.cutoutRegistry[t])return this.cutoutRegistry[t];var e=h({u_opacity:0,u_transform:l.slice(),u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});return this.cutoutRegistryKeys.push(t),this.cutoutRegistry[t]={uniformKeys:e.keys,uniformValues:e.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0},this.cutoutRegistry[t]},r.prototype.setMeshVisibility=function(t,e){var i=this.meshRegistry[t]||this.createMesh(t);i.visible=e},r.prototype.removeMesh=function(t){var e=this.meshRegistryKeys.indexOf(t);this.meshRegistryKeys.splice(e,1),this.meshRegistry[t]=null},r.prototype.setCutoutUniform=function(t,e,i){var r=this.getOrSetCutout(t),s=r.uniformKeys.indexOf(e);if(Array.isArray(i))for(var n=0,o=i.length;o>n;n++)r.uniformValues[s][n]=i[n];else r.uniformValues[s]=i},r.prototype.setMeshOptions=function(t,e){var i=this.meshRegistry[t]||this.createMesh(t);return i.options=e,this},r.prototype.setAmbientLightColor=function(t,e,i,r){return this.ambientLightColor[0]=e,this.ambientLightColor[1]=i,this.ambientLightColor[2]=r,this},r.prototype.setLightPosition=function(t,e,i,r){var s=this.lightRegistry[t]||this.createLight(t);return s.position[0]=e,s.position[1]=i,s.position[2]=r,this},r.prototype.setLightColor=function(t,e,i,r){var s=this.lightRegistry[t]||this.createLight(t);return s.color[0]=e,s.color[1]=i,s.color[2]=r,this},r.prototype.handleMaterialInput=function(t,e,i){var r=this.meshRegistry[t]||this.createMesh(t);i=p(i,r.textures.length),r.uniformValues[r.uniformKeys.indexOf(e)][0]=-i._id;for(var s=i.textures.length;s--;)r.textures.push(this.textureManager.register(i.textures[s],r.textures.length+s));return this.program.registerMaterial(e,i),this.updateSize()},r.prototype.setGeometry=function(t,e,i,r){var s=this.meshRegistry[t]||this.createMesh(t);return s.geometry=e,s.drawType=i,s.dynamic=r,this},r.prototype.setMeshUniform=function(t,e,i){var r=this.meshRegistry[t]||this.createMesh(t),s=r.uniformKeys.indexOf(e);-1===s?(r.uniformKeys.push(e),r.uniformValues.push(i)):r.uniformValues[s]=i},r.prototype.bufferData=function(t,e,i,r,s,n){return this.bufferRegistry.allocate(e,i,r,s,n),this},r.prototype.draw=function(t){var e=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.textureManager.update(e),this.meshRegistryKeys=a(this.meshRegistryKeys,this.meshRegistry),this.setGlobalUniforms(t),this.drawCutouts(),this.drawMeshes()},r.prototype.drawMeshes=function(){for(var t,e,i=this.gl,r=0;r<this.meshRegistryKeys.length;r++)if(e=this.meshRegistry[this.meshRegistryKeys[r]],t=this.bufferRegistry.registry[e.geometry],e.visible&&(e.uniformValues[0]<1?(i.depthMask(!1),i.enable(i.BLEND)):(i.depthMask(!0),i.disable(i.BLEND)),t)){for(var s=e.textures.length;s--;)this.textureManager.bindTexture(e.textures[s]);e.options&&this.handleOptions(e.options,e),this.program.setUniforms(e.uniformKeys,e.uniformValues),this.drawBuffers(t,e.drawType,e.geometry),e.options&&this.resetOptions(e.options)}},r.prototype.drawCutouts=function(){var t,e,i=this.cutoutRegistryKeys.length;i&&(this.gl.enable(this.gl.BLEND),this.gl.depthMask(!0));for(var r=0;i>r;r++)t=this.cutoutRegistry[this.cutoutRegistryKeys[r]],e=this.bufferRegistry.registry[t.geometry],t.visible&&(this.program.setUniforms(t.uniformKeys,t.uniformValues),this.drawBuffers(e,t.drawType,t.geometry))},r.prototype.setGlobalUniforms=function(t){for(var e,i,r=0,s=this.lightRegistryKeys.length;s>r;r++)e=this.lightRegistry[this.lightRegistryKeys[r]],i=4*r,this.lightPositions[0+i]=e.position[0],this.lightPositions[1+i]=e.position[1],this.lightPositions[2+i]=e.position[2],this.lightColors[0+i]=e.color[0],this.lightColors[1+i]=e.color[1],this.lightColors[2+i]=e.color[2];c.values[0]=this.numLights,c.values[1]=this.ambientLightColor,c.values[2]=this.lightPositions,c.values[3]=this.lightColors,this.projectionTransform[0]=1/(.5*this.cachedSize[0]),this.projectionTransform[5]=-1/(.5*this.cachedSize[1]),this.projectionTransform[11]=t.perspectiveTransform[11],c.values[4]=this.projectionTransform,c.values[5]=.001*this.compositor.getTime(),c.values[6]=t.viewTransform,this.program.setUniforms(c.keys,c.values)},r.prototype.drawBuffers=function(t,e,i){var r,s,n,o,a,h,u,p,l=this.gl,c=0;for(h=t.keys.length,p=0;h>p;p++)r=t.keys[p],"indices"!==r?(s=this.program.attributeLocations[r],-1!==s&&(void 0!==s||(s=l.getAttribLocation(this.program.program,r),this.program.attributeLocations[r]=s,-1!==s))&&(this.state.enabledAttributes[r]||(l.enableVertexAttribArray(s),this.state.enabledAttributes[r]=!0,this.state.enabledAttributesKeys.push(r)),a=t.values[p],n=t.spacing[p],o=t.offset[p],c=t.length[p],this.state.boundArrayBuffer!==a&&(l.bindBuffer(a.target,a.buffer),this.state.boundArrayBuffer=a),this.state.lastDrawn!==i&&l.vertexAttribPointer(s,n,l.FLOAT,l.FALSE,0,4*o))):u=p;var f=this.state.enabledAttributesKeys.length;for(p=0;f>p;p++){var d=this.state.enabledAttributesKeys[p];this.state.enabledAttributes[d]&&-1===t.keys.indexOf(d)&&(l.disableVertexAttribArray(this.program.attributeLocations[d]),this.state.enabledAttributes[d]=!1)}c&&(void 0!==u?(a=t.values[u],o=t.offset[u],n=t.spacing[u],c=t.length[u],this.state.boundElementBuffer!==a&&(l.bindBuffer(a.target,a.buffer),this.state.boundElementBuffer=a),l.drawElements(l[e],c,l.UNSIGNED_SHORT,2*o)):l.drawArrays(l[e],0,c)),this.state.lastDrawn=i},r.prototype.updateSize=function(t){if(t){var e=window.devicePixelRatio||1,i=~~(t[0]*e),r=~~(t[1]*e);this.canvas.width=i,this.canvas.height=r,this.gl.viewport(0,0,i,r),this.cachedSize[0]=t[0],this.cachedSize[1]=t[1],this.cachedSize[2]=t[0]>t[1]?t[0]:t[1],this.resolutionValues[0]=this.cachedSize}return this.program.setUniforms(this.resolutionName,this.resolutionValues),this},r.prototype.handleOptions=function(t,e){var i=this.gl;t&&("double"===t.side&&(this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[e.geometry],e.drawType,e.geometry),this.gl.cullFace(this.gl.BACK)),t.blending&&i.blendFunc(i.SRC_ALPHA,i.ONE),"back"===t.side&&i.cullFace(i.FRONT))},r.prototype.resetOptions=function(t){var e=this.gl;t&&(t.blending&&e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),"back"===t.side&&e.cullFace(e.BACK))},e.exports=r},{"../utilities/keyValueToArrays":38,"../webgl-geometries/primitives/Plane":42,"./BufferRegistry":44,"./Program":46,"./TextureManager":48,"./compileMaterial":50,"./radixSort":52}],50:[function(t,e,i){"use strict";function r(t,e){var i="",r={},u={},l={},c=[],f=[];return s(t,function(t,s){if(t.chunk){var d=p[n(t)],m=a(t),_=o(t.chunk.glsl,t.inputs,f.length+e);i+=d+m+" = "+_+"\n ",t.uniforms&&h(r,t.uniforms),t.varyings&&h(u,t.varyings),t.attributes&&h(l,t.attributes),t.chunk.defines&&c.push(t.chunk.defines),t.texture&&f.push(t.texture)}}),{_id:t._id,glsl:i+"return "+a(t)+";",defines:c.join("\n"),uniforms:r,varyings:u,attributes:l,textures:f}}function s(t,e){for(var i=t.inputs,r=i&&i.length,n=-1;++n<r;)s(i[n],e);return e(t),t}function n(t){if("number"==typeof t)return 1;if(Array.isArray(t))return t.length;var e=t.chunk.output;if("number"==typeof e)return e;var i=t.inputs.map(function(t){return n(t)}).join(",");return e[i]}function o(t,e,i){return t.replace(/%\d/g,function(t){return a(e[t[1]-1])}).replace(/\$TEXTURE/,"u_textures["+i+"]")}function a(t){return Array.isArray(t)?u(t):"object"==typeof t?"fa_"+t._id:t.toFixed(6)}function h(t,e){for(var i in e)t[i]=e[i]}function u(t){var e=t.length;return"vec"+e+"("+t.join(",")+")"}var p={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};e.exports=r},{}],51:[function(t,e,i){"use strict";function r(){var t=document.createElement("canvas").getContext("2d");t.canvas.width=t.canvas.height=128;for(var e=0;e<t.canvas.height;e+=16)for(var i=0;i<t.canvas.width;i+=16)t.fillStyle=16&(i^e)?"#FFF":"#DDD",t.fillRect(i,e,16,16);return t.canvas}e.exports=r},{}],52:[function(t,e,i){"use strict";function r(t,e,i){var r=t[i],s=e[r];return(s.depth?s.depth:e[r].uniformValues[1][14])+g}function s(t,e,i,r){var s=t[i];return e[s].depth=a(r)-g,s}function n(t,e,i){e[t[i]].depth=null}function o(t){return v[0]=t,b[0]}function a(t){return b[0]=t,v[0]}function h(t,e){var i,a,h,f,g,y,v,b,w,T,x,E=0,S=[];for(m=32/u+.999999999999999|0,i=0,f=p*m;f>i;i++)c[i]=0;for(i=0,f=t.length;f>i;i++){for(g=o(r(t,e,i)),g^=g>>31|2147483648,a=0,h=0;_>a;a+=p,h+=u)c[a+(g>>>h&l)]++;c[a+(g>>>h&d)]++}for(a=0;_>=a;a+=p)for(b=a,w=0;a+p>b;b++)T=c[b]+w,c[b]=w-1,w=T;if(--m){for(i=0,f=t.length;f>i;i++)g=o(r(t,e,i)),S[++c[g&l]]=s(t,e,i,g^=g>>31|2147483648);for(v=S,S=t,t=v;++E<m;){for(i=0,f=t.length,y=E*p,x=E*u;f>i;i++)g=o(r(t,e,i)),S[++c[y+(g>>>x&l)]]=t[i];v=S,S=t,t=v}}for(i=0,f=t.length,y=E*p,x=E*u;f>i;i++)g=o(r(t,e,i)),S[++c[y+(g>>>x&d)]]=s(t,e,i,g^(~g>>31|2147483648)),n(t,e,i);return S}var u=11,p=1<<u,l=p-1,c=new Array(p*Math.ceil(64/u)),f=1<<31%u,d=(f<<1)-1,m=32/u+.999999999999999|0,_=p*(m-1),g=Math.pow(20,6),y=new ArrayBuffer(4),v=new Float32Array(y,0,1),b=new Int32Array(y,0,1);e.exports=h},{}],53:[function(t,e,i){"use strict";var r=(t("glslify"),t("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nmat3 a_x_getNormalMatrix(in mat4 t) {\n  mat3 matNorm;\n  mat4 a = t;\n  float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3], a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3], a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3], a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32, det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  det = 1.0 / det;\n  matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return matNorm;\n}\nfloat b_x_inverse(float m) {\n  return 1.0 / m;\n}\nmat2 b_x_inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\nmat3 b_x_inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11), b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10), b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\nmat4 b_x_inverse(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32, det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  return mat4(a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07, a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06, a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00, a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\nfloat c_x_transpose(float m) {\n  return m;\n}\nmat2 c_x_transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0], m[0][1], m[1][1]);\n}\nmat3 c_x_transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0], m[0][1], m[1][1], m[2][1], m[0][2], m[1][2], m[2][2]);\n}\nmat4 c_x_transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0], m[0][1], m[1][1], m[2][1], m[3][1], m[0][2], m[1][2], m[2][2], m[3][2], m[0][3], m[1][3], m[2][3], m[3][3]);\n}\nvec4 applyTransform(vec4 pos) {\n  mat4 MVMatrix = u_view * u_transform;\n  pos.x += 1.0;\n  pos.y -= 1.0;\n  pos.xyz *= u_size * 0.5;\n  pos.y *= -1.0;\n  v_position = (MVMatrix * pos).xyz;\n  v_eyeVector = (u_resolution * 0.5) - v_position;\n  pos = u_perspective * MVMatrix * pos;\n  return pos;\n}\n#vert_definitions\n\nvec3 calculateOffset(vec3 ID) {\n  \n  #vert_applications\n  return vec3(0.0);\n}\nvoid main() {\n  v_textureCoordinate = a_texCoord;\n  vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\n  invertedNormals.y *= -1.0;\n  v_normal = c_x_transpose(mat3(b_x_inverse(u_transform))) * invertedNormals;\n  vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\n  gl_Position = applyTransform(vec4(offsetPos, 1.0));\n}","\n#define GLSLIFY 1\n\n#float_definitions\n\nfloat a_x_applyMaterial(float ID) {\n  \n  #float_applications\n  return 1.;\n}\n#vec3_definitions\n\nvec3 a_x_applyMaterial(vec3 ID) {\n  \n  #vec3_applications\n  return vec3(0);\n}\n#vec4_definitions\n\nvec4 a_x_applyMaterial(vec4 ID) {\n  \n  #vec4_applications\n  return vec4(0);\n}\nvec4 b_x_applyLight(in vec4 baseColor, in vec3 normal, in vec4 glossiness) {\n  int numLights = int(u_numLights);\n  vec3 ambientColor = u_ambientLight * baseColor.rgb;\n  vec3 eyeVector = normalize(v_eyeVector);\n  vec3 diffuse = vec3(0.0);\n  bool hasGlossiness = glossiness.a > 0.0;\n  bool hasSpecularColor = length(glossiness.rgb) > 0.0;\n  for(int i = 0; i < 4; i++) {\n    if(i >= numLights)\n      break;\n    vec3 lightDirection = normalize(u_lightPosition[i].xyz - v_position);\n    float lambertian = max(dot(lightDirection, normal), 0.0);\n    if(lambertian > 0.0) {\n      diffuse += u_lightColor[i].rgb * baseColor.rgb * lambertian;\n      if(hasGlossiness) {\n        vec3 halfVector = normalize(lightDirection + eyeVector);\n        float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\n        vec3 specularColor = hasSpecularColor ? glossiness.rgb : u_lightColor[i].rgb;\n        diffuse += specularColor * specularWeight * lambertian;\n      }\n    }\n  }\n  return vec4(ambientColor + diffuse, baseColor.a);\n}\nvoid main() {\n  vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : a_x_applyMaterial(u_baseColor);\n  bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\n  vec3 normal = normalize(v_normal);\n  vec4 glossiness = u_glossiness.x < 0.0 ? a_x_applyMaterial(u_glossiness) : u_glossiness;\n  vec4 color = lightsEnabled ? b_x_applyLight(material, normalize(v_normal), glossiness) : material;\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}",[],[]));
e.exports=r},{glslify:27,"glslify/simple-adapter.js":28}],54:[function(t,e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=p.default.addChild(),i=c.default.getThumbnailSize(),r=c.default.getPixelCoords(t),s=Math.floor(f.h/i.h)*i.h,n=i.h/4,o=void 0,a=void 0;return new h.default(e,{tagName:"img"}).setAttribute("src","./images/car"+("000"+(t+1)).slice(-3)+".jpg"),e.setSizeMode("absolute","absolute","absolute").setAbsoluteSize(i.w,i.h),s<r.y?void e.setPosition(r.x,r.y):(e.setPosition(r.x,s),o={onUpdate:function(){var t=e.getPosition()[0],i=e.getPosition()[1];return i>r.y?(e.setPosition(t,i-n),void e.requestUpdateOnNextTick(a)):void e.removeComponent(o)}},a=e.addComponent(o),void e.requestUpdate(a))}Object.defineProperty(i,"__esModule",{value:!0});var n=t("./getViewportSize"),o=r(n),a=t("famous/dom-renderables/DOMElement"),h=r(a),u=t("./scene"),p=r(u),l=t("./calculator"),c=r(l),f=o.default();i.default=s,e.exports=i.default},{"./calculator":55,"./getViewportSize":57,"./scene":58,"famous/dom-renderables/DOMElement":11}],55:[function(t,e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function s(){return Math.floor(c.w/l.default.targetThumbnailWidth)}function n(){var t=c.w/s(),e=t*l.default.thumbnailAspectRatio;return{w:t,h:e}}function o(t){var e=s(),i=t%e,r=Math.floor(t/e);return{row:r,col:i}}function a(t){var e=o(t),i=n(),r=e.col*i.w,s=e.row*i.h;return{x:r,y:s}}Object.defineProperty(i,"__esModule",{value:!0});var h=t("./getViewportSize"),u=r(h),p=t("./settings"),l=r(p),c=u.default();i.default={getColumns:s,getThumbnailSize:n,getGridCoords:o,getPixelCoords:a},e.exports=i.default},{"./getViewportSize":57,"./settings":59}],56:[function(t,e,i){"use strict";function r(t,e){return function(i){return window.setTimeout(function(){return e.apply(null,i)},t)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=r,e.exports=i.default},{}],57:[function(t,e,i){"use strict";function r(){if("undefined"==typeof document.documentElement.clientWidth)throw new Error("unsupported browser");return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=r,e.exports=i.default},{}],58:[function(t,e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=t("famous/core/FamousEngine"),n=r(s);n.default.init(),i.default=n.default.createScene(),e.exports=i.default},{"famous/core/FamousEngine":6}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={targetThumbnailWidth:240,thumbnailAspectRatio:.75},e.exports=i.default},{}],60:[function(t,e,i){"use strict";var r,s=t("./addCar"),n=t("./delay");for(r=0;100>r;r++)n(30*r+100*Math.random(),s)(r)},{"./addCar":54,"./delay":56}]},{},[60]);
